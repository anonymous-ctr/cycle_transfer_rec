auc=0.915; acc=0.8409800000000001
pr:	0.13397 0.12264000000000001 0.11052 0.10207999999999999 0.09549999999999999 0.08578 0.07335
re:	0.02496 0.05641999999999999 0.10024000000000002 0.13699 0.16907999999999998 0.22398 0.31237
f1:	0.042089999999999995 0.07729 0.10513000000000002 0.11698000000000001 0.12207000000000001 0.12405 0.11878999999999999
ndcg:	0.20083 0.27956000000000003 0.32436 0.34327 0.3536500000000001 0.36549 0.37673000000000006


/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 19:18:15.427711 139768586909440 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 19:18:15.450593 139768586909440 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 19:18:15.451368 139768586909440 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 19:18:15.490345 139768586909440 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 19:18:15.546075 139768586909440 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 19:18:15.548180 139768586909440 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 19:18:15.588500 139768586909440 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 19:18:15.612465 139768586909440 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 19:18:17.589785 139768586909440 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 19:18:17.593528: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 19:18:17.604745: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:18:17.604966: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:18:17.606171: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:18:17.607408: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:18:17.607717: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:18:17.609022: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:18:17.610319: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:18:17.614669: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:18:17.616985: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:18:17.618422: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 19:18:17.741403: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x56293cbb14f0 executing computations on platform CUDA. Devices:
2020-01-07 19:18:17.741492: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 19:18:17.761501: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 19:18:17.763793: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x56293cca9350 executing computations on platform Host. Devices:
2020-01-07 19:18:17.763838: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 19:18:17.765135: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:18:17.765187: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:18:17.765202: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:18:17.765215: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:18:17.765228: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:18:17.765242: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:18:17.765255: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:18:17.765268: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:18:17.767272: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:18:17.767308: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:18:17.768939: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 19:18:17.768953: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 19:18:17.768961: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 19:18:17.771509: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 19:18:17.774508 139768586909440 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 19:18:19.660621: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=1, batch_size=4096, dataset='movie', dim=8, gpu_id='0', kge_interval=3, l2_weight=1e-06, lr_kge=0.01, lr_rs=0.02, n_epochs=20)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.8892  acc: 0.8035    eval auc: 0.8836  acc: 0.8009    test auc: 0.8839  acc: 0.8009, pre: 0.8067, rec: 0.7922, f1: 0.7994
precision: 0.1124	0.1032	0.0939	0.0892	0.0851	0.0755	0.0623	
recall: 0.0193	0.0455	0.0861	0.1220	0.1544	0.2082	0.2781	
f1: 0.0330	0.0631	0.0898	0.1030	0.1097	0.1108	0.1018	
ndcg: 0.1638	0.2357	0.2858	0.3071	0.3196	0.3346	0.3465	

epoch 1    train auc: 0.8994  acc: 0.8140    eval auc: 0.8875  acc: 0.8076    test auc: 0.8879  acc: 0.8068, pre: 0.7909, rec: 0.8348, f1: 0.8123
precision: 0.1186	0.1125	0.1022	0.0904	0.0844	0.0753	0.0637	
recall: 0.0218	0.0525	0.0968	0.1270	0.1550	0.2049	0.2824	
f1: 0.0369	0.0716	0.0994	0.1056	0.1093	0.1102	0.1040	
ndcg: 0.1770	0.2562	0.3042	0.3208	0.3309	0.3437	0.3564	

epoch 2    train auc: 0.9171  acc: 0.8359    eval auc: 0.8976  acc: 0.8193    test auc: 0.8987  acc: 0.8206, pre: 0.8040, rec: 0.8486, f1: 0.8257
precision: 0.1193	0.1125	0.1043	0.0963	0.0898	0.0801	0.0674	
recall: 0.0219	0.0514	0.0942	0.1331	0.1656	0.2165	0.2966	
f1: 0.0371	0.0706	0.0990	0.1118	0.1164	0.1170	0.1098	
ndcg: 0.1802	0.2588	0.3054	0.3259	0.3393	0.3524	0.3640	

epoch 3    train auc: 0.9264  acc: 0.8468    eval auc: 0.9008  acc: 0.8231    test auc: 0.9020  acc: 0.8240, pre: 0.8119, rec: 0.8439, f1: 0.8276
precision: 0.1242	0.1101	0.1020	0.0942	0.0888	0.0789	0.0672	
recall: 0.0234	0.0514	0.0948	0.1320	0.1630	0.2124	0.2910	
f1: 0.0394	0.0701	0.0982	0.1100	0.1150	0.1151	0.1091	
ndcg: 0.1911	0.2639	0.3113	0.3293	0.3405	0.3528	0.3650	

epoch 4    train auc: 0.9313  acc: 0.8523    eval auc: 0.9038  acc: 0.8268    test auc: 0.9049  acc: 0.8272, pre: 0.8143, rec: 0.8482, f1: 0.8309
precision: 0.1223	0.1140	0.1040	0.0964	0.0910	0.0815	0.0691	
recall: 0.0222	0.0522	0.0950	0.1305	0.1636	0.2180	0.3002	
f1: 0.0376	0.0716	0.0993	0.1109	0.1169	0.1186	0.1124	
ndcg: 0.1841	0.2612	0.3074	0.3259	0.3381	0.3521	0.3644	

epoch 5    train auc: 0.9354  acc: 0.8579    eval auc: 0.9042  acc: 0.8284    test auc: 0.9056  acc: 0.8286, pre: 0.8120, rec: 0.8558, f1: 0.8333
precision: 0.1227	0.1149	0.1042	0.0963	0.0899	0.0803	0.0681	
recall: 0.0225	0.0542	0.0966	0.1329	0.1630	0.2138	0.2954	
f1: 0.0381	0.0736	0.1003	0.1117	0.1159	0.1168	0.1107	
ndcg: 0.1882	0.2642	0.3096	0.3302	0.3418	0.3545	0.3655	

epoch 6    train auc: 0.9383  acc: 0.8620    eval auc: 0.9056  acc: 0.8303    test auc: 0.9066  acc: 0.8302, pre: 0.8159, rec: 0.8534, f1: 0.8342
precision: 0.1366	0.1178	0.1055	0.0955	0.0896	0.0799	0.0681	
recall: 0.0251	0.0547	0.0981	0.1317	0.1613	0.2139	0.2951	
f1: 0.0424	0.0747	0.1017	0.1107	0.1152	0.1163	0.1106	
ndcg: 0.2056	0.2773	0.3214	0.3387	0.3492	0.3612	0.3710	

epoch 7    train auc: 0.9409  acc: 0.8645    eval auc: 0.9076  acc: 0.8318    test auc: 0.9089  acc: 0.8329, pre: 0.8137, rec: 0.8641, f1: 0.8381
precision: 0.1354	0.1221	0.1080	0.0986	0.0922	0.0826	0.0699	
recall: 0.0265	0.0590	0.1010	0.1355	0.1669	0.2179	0.3010	
f1: 0.0443	0.0796	0.1044	0.1142	0.1188	0.1197	0.1134	
ndcg: 0.2044	0.2835	0.3251	0.3427	0.3537	0.3656	0.3760	

epoch 8    train auc: 0.9428  acc: 0.8675    eval auc: 0.9088  acc: 0.8331    test auc: 0.9101  acc: 0.8342, pre: 0.8205, rec: 0.8563, f1: 0.8380
precision: 0.1343	0.1203	0.1081	0.0988	0.0923	0.0831	0.0704	
recall: 0.0267	0.0574	0.1009	0.1367	0.1686	0.2247	0.3046	
f1: 0.0446	0.0777	0.1044	0.1147	0.1193	0.1213	0.1144	
ndcg: 0.2003	0.2773	0.3200	0.3391	0.3498	0.3640	0.3736	

epoch 9    train auc: 0.9440  acc: 0.8688    eval auc: 0.9096  acc: 0.8339    test auc: 0.9106  acc: 0.8345, pre: 0.8256, rec: 0.8487, f1: 0.8370
precision: 0.1182	0.1130	0.1042	0.0971	0.0918	0.0829	0.0706	
recall: 0.0222	0.0531	0.0948	0.1320	0.1644	0.2189	0.3038	
f1: 0.0373	0.0722	0.0993	0.1119	0.1178	0.1203	0.1145	
ndcg: 0.1751	0.2561	0.3039	0.3237	0.3362	0.3498	0.3634	

epoch 10    train auc: 0.9458  acc: 0.8711    eval auc: 0.9101  acc: 0.8347    test auc: 0.9115  acc: 0.8371, pre: 0.8209, rec: 0.8629, f1: 0.8414
precision: 0.1227	0.1192	0.1060	0.0981	0.0916	0.0824	0.0710	
recall: 0.0231	0.0548	0.0965	0.1326	0.1639	0.2185	0.3046	
f1: 0.0389	0.0751	0.1010	0.1127	0.1176	0.1196	0.1152	
ndcg: 0.1845	0.2680	0.3116	0.3319	0.3427	0.3562	0.3683	

epoch 11    train auc: 0.9464  acc: 0.8716    eval auc: 0.9110  acc: 0.8362    test auc: 0.9123  acc: 0.8381, pre: 0.8254, rec: 0.8582, f1: 0.8415
precision: 0.1416	0.1263	0.1117	0.1024	0.0956	0.0855	0.0723	
recall: 0.0270	0.0600	0.1028	0.1393	0.1719	0.2276	0.3135	
f1: 0.0454	0.0814	0.1071	0.1180	0.1229	0.1244	0.1175	
ndcg: 0.2106	0.2874	0.3320	0.3504	0.3604	0.3713	0.3823	

epoch 12    train auc: 0.9472  acc: 0.8731    eval auc: 0.9108  acc: 0.8357    test auc: 0.9120  acc: 0.8373, pre: 0.8258, rec: 0.8557, f1: 0.8405
epoch 13    train auc: 0.9482  acc: 0.8743    eval auc: 0.9114  acc: 0.8362    test auc: 0.9130  acc: 0.8387, pre: 0.8213, rec: 0.8663, f1: 0.8432
precision: 0.1335	0.1200	0.1071	0.0987	0.0934	0.0844	0.0724	
recall: 0.0248	0.0553	0.0973	0.1334	0.1670	0.2234	0.3124	
f1: 0.0418	0.0757	0.1020	0.1134	0.1198	0.1225	0.1176	
ndcg: 0.2006	0.2755	0.3188	0.3386	0.3499	0.3627	0.3752	

epoch 14    train auc: 0.9488  acc: 0.8747    eval auc: 0.9128  acc: 0.8370    test auc: 0.9140  acc: 0.8391, pre: 0.8298, rec: 0.8539, f1: 0.8417
precision: 0.1391	0.1248	0.1107	0.1015	0.0950	0.0849	0.0732	
recall: 0.0268	0.0586	0.0995	0.1366	0.1687	0.2224	0.3115	
f1: 0.0450	0.0797	0.1048	0.1164	0.1215	0.1229	0.1185	
ndcg: 0.2078	0.2828	0.3242	0.3444	0.3541	0.3651	0.3778	

epoch 15    train auc: 0.9492  acc: 0.8759    eval auc: 0.9125  acc: 0.8380    test auc: 0.9136  acc: 0.8396, pre: 0.8221, rec: 0.8674, f1: 0.8441
precision: 0.1360	0.1240	0.1093	0.1005	0.0941	0.0846	0.0724	
recall: 0.0257	0.0582	0.1003	0.1362	0.1693	0.2245	0.3120	
f1: 0.0432	0.0792	0.1046	0.1157	0.1210	0.1229	0.1176	
ndcg: 0.2036	0.2834	0.3269	0.3457	0.3558	0.3675	0.3789	

epoch 16    train auc: 0.9503  acc: 0.8769    eval auc: 0.9128  acc: 0.8379    test auc: 0.9139  acc: 0.8391, pre: 0.8294, rec: 0.8543, f1: 0.8417
epoch 17    train auc: 0.9506  acc: 0.8774    eval auc: 0.9128  acc: 0.8380    test auc: 0.9138  acc: 0.8393, pre: 0.8205, rec: 0.8690, f1: 0.8441
precision: 0.1294	0.1174	0.1072	0.0990	0.0940	0.0850	0.0731	
recall: 0.0241	0.0526	0.0949	0.1308	0.1646	0.2215	0.3118	
f1: 0.0407	0.0727	0.1006	0.1127	0.1196	0.1228	0.1185	
ndcg: 0.1946	0.2696	0.3156	0.3356	0.3471	0.3591	0.3718	

epoch 18    train auc: 0.9504  acc: 0.8774    eval auc: 0.9123  acc: 0.8377    test auc: 0.9132  acc: 0.8389, pre: 0.8270, rec: 0.8577, f1: 0.8420
epoch 19    train auc: 0.9513  acc: 0.8790    eval auc: 0.9136  acc: 0.8388    test auc: 0.9144  acc: 0.8409, pre: 0.8260, rec: 0.8644, f1: 0.8448
precision: 0.1324	0.1191	0.1081	0.1009	0.0949	0.0862	0.0732	
recall: 0.0243	0.0541	0.0974	0.1349	0.1674	0.2241	0.3100	
f1: 0.0410	0.0744	0.1025	0.1154	0.1211	0.1245	0.1185	
ndcg: 0.2000	0.2735	0.3175	0.3376	0.3494	0.3629	0.3737	

/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 19:26:46.341897 139878778750720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 19:26:46.360037 139878778750720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 19:26:46.360690 139878778750720 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 19:26:46.394942 139878778750720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 19:26:46.444386 139878778750720 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 19:26:46.446187 139878778750720 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 19:26:46.480499 139878778750720 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 19:26:46.501107 139878778750720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 19:26:48.223433 139878778750720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 19:26:48.225617: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 19:26:48.234636: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:26:48.234826: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:26:48.235867: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:26:48.236938: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:26:48.237203: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:26:48.238394: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:26:48.239544: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:26:48.243235: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:26:48.245167: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:26:48.245890: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 19:26:48.364943: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55d6f79b9160 executing computations on platform CUDA. Devices:
2020-01-07 19:26:48.365022: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 19:26:48.389684: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 19:26:48.392036: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55d6f7ab0fe0 executing computations on platform Host. Devices:
2020-01-07 19:26:48.392068: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 19:26:48.393352: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:26:48.393410: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:26:48.393427: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:26:48.393440: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:26:48.393454: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:26:48.393468: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:26:48.393481: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:26:48.393496: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:26:48.395458: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:26:48.395487: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:26:48.396942: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 19:26:48.396963: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 19:26:48.396970: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 19:26:48.399224: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 19:26:48.401937 139878778750720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 19:26:50.175413: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=1, batch_size=4096, dataset='movie', dim=8, gpu_id='0', kge_interval=3, l2_weight=1e-06, lr_kge=0.01, lr_rs=0.02, n_epochs=20)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.8885  acc: 0.8003    eval auc: 0.8831  acc: 0.7975    test auc: 0.8837  acc: 0.7979, pre: 0.8158, rec: 0.7704, f1: 0.7924
precision: 0.1082	0.1076	0.0948	0.0879	0.0845	0.0740	0.0622	
recall: 0.0212	0.0530	0.0910	0.1210	0.1560	0.2043	0.2785	
f1: 0.0355	0.0711	0.0929	0.1018	0.1096	0.1086	0.1016	
ndcg: 0.1650	0.2488	0.2941	0.3131	0.3273	0.3412	0.3532	

epoch 1    train auc: 0.8980  acc: 0.8134    eval auc: 0.8869  acc: 0.8057    test auc: 0.8877  acc: 0.8062, pre: 0.7931, rec: 0.8293, f1: 0.8108
precision: 0.1009	0.1008	0.0964	0.0904	0.0848	0.0749	0.0634	
recall: 0.0205	0.0471	0.0901	0.1246	0.1572	0.2044	0.2785	
f1: 0.0341	0.0642	0.0931	0.1048	0.1102	0.1096	0.1034	
ndcg: 0.1521	0.2305	0.2796	0.3033	0.3185	0.3341	0.3474	

epoch 2    train auc: 0.9147  acc: 0.8326    eval auc: 0.8981  acc: 0.8190    test auc: 0.8989  acc: 0.8197, pre: 0.8062, rec: 0.8423, f1: 0.8239
precision: 0.1237	0.1174	0.1059	0.0990	0.0924	0.0806	0.0670	
recall: 0.0246	0.0579	0.1020	0.1411	0.1737	0.2218	0.2951	
f1: 0.0411	0.0776	0.1039	0.1163	0.1206	0.1182	0.1092	
ndcg: 0.1860	0.2688	0.3150	0.3358	0.3484	0.3604	0.3704	

epoch 3    train auc: 0.9231  acc: 0.8421    eval auc: 0.9019  acc: 0.8232    test auc: 0.9026  acc: 0.8233, pre: 0.8188, rec: 0.8309, f1: 0.8248
precision: 0.1327	0.1203	0.1088	0.0982	0.0904	0.0801	0.0675	
recall: 0.0266	0.0566	0.1010	0.1356	0.1660	0.2179	0.2980	
f1: 0.0443	0.0770	0.1048	0.1139	0.1171	0.1171	0.1101	
ndcg: 0.1984	0.2747	0.3191	0.3369	0.3489	0.3612	0.3718	

epoch 4    train auc: 0.9288  acc: 0.8494    eval auc: 0.9044  acc: 0.8280    test auc: 0.9054  acc: 0.8278, pre: 0.8106, rec: 0.8563, f1: 0.8328
precision: 0.1286	0.1195	0.1081	0.0994	0.0924	0.0821	0.0689	
recall: 0.0260	0.0568	0.1030	0.1386	0.1700	0.2236	0.3019	
f1: 0.0433	0.0770	0.1055	0.1157	0.1197	0.1201	0.1122	
ndcg: 0.1926	0.2731	0.3193	0.3388	0.3497	0.3622	0.3727	

epoch 5    train auc: 0.9342  acc: 0.8560    eval auc: 0.9067  acc: 0.8309    test auc: 0.9070  acc: 0.8311, pre: 0.8137, rec: 0.8593, f1: 0.8359
precision: 0.1366	0.1237	0.1119	0.1027	0.0950	0.0833	0.0696	
recall: 0.0268	0.0582	0.1039	0.1423	0.1742	0.2256	0.3055	
f1: 0.0449	0.0792	0.1078	0.1193	0.1229	0.1217	0.1134	
ndcg: 0.2077	0.2830	0.3284	0.3474	0.3581	0.3684	0.3785	

epoch 6    train auc: 0.9378  acc: 0.8605    eval auc: 0.9081  acc: 0.8330    test auc: 0.9085  acc: 0.8326, pre: 0.8215, rec: 0.8504, f1: 0.8357
precision: 0.1307	0.1196	0.1095	0.0994	0.0925	0.0824	0.0700	
recall: 0.0252	0.0563	0.1022	0.1369	0.1693	0.2228	0.3067	
f1: 0.0422	0.0766	0.1057	0.1152	0.1196	0.1203	0.1139	
ndcg: 0.1967	0.2725	0.3221	0.3395	0.3504	0.3622	0.3735	

epoch 7    train auc: 0.9407  acc: 0.8641    eval auc: 0.9097  acc: 0.8342    test auc: 0.9102  acc: 0.8343, pre: 0.8205, rec: 0.8563, f1: 0.8380
precision: 0.1292	0.1221	0.1094	0.1015	0.0936	0.0835	0.0710	
recall: 0.0243	0.0577	0.1012	0.1396	0.1709	0.2244	0.3095	
f1: 0.0409	0.0783	0.1051	0.1176	0.1209	0.1217	0.1155	
ndcg: 0.1964	0.2768	0.3221	0.3414	0.3519	0.3637	0.3748	

epoch 8    train auc: 0.9432  acc: 0.8663    eval auc: 0.9103  acc: 0.8346    test auc: 0.9105  acc: 0.8340, pre: 0.8277, rec: 0.8442, f1: 0.8359
precision: 0.1434	0.1243	0.1080	0.1000	0.0925	0.0834	0.0713	
recall: 0.0268	0.0574	0.1004	0.1382	0.1688	0.2252	0.3105	
f1: 0.0452	0.0785	0.1041	0.1160	0.1195	0.1217	0.1159	
ndcg: 0.2145	0.2874	0.3275	0.3467	0.3560	0.3684	0.3782	

epoch 9    train auc: 0.9448  acc: 0.8692    eval auc: 0.9103  acc: 0.8356    test auc: 0.9107  acc: 0.8351, pre: 0.8242, rec: 0.8525, f1: 0.8381
precision: 0.1372	0.1214	0.1073	0.0978	0.0913	0.0818	0.0702	
recall: 0.0252	0.0568	0.1000	0.1346	0.1655	0.2191	0.3040	
f1: 0.0426	0.0774	0.1035	0.1133	0.1177	0.1192	0.1140	
ndcg: 0.2055	0.2810	0.3225	0.3394	0.3512	0.3627	0.3731	

epoch 10    train auc: 0.9458  acc: 0.8709    eval auc: 0.9117  acc: 0.8376    test auc: 0.9122  acc: 0.8371, pre: 0.8222, rec: 0.8609, f1: 0.8411
precision: 0.1434	0.1265	0.1115	0.1012	0.0944	0.0851	0.0725	
recall: 0.0267	0.0604	0.1046	0.1402	0.1702	0.2273	0.3161	
f1: 0.0450	0.0818	0.1079	0.1176	0.1215	0.1238	0.1179	
ndcg: 0.2118	0.2898	0.3341	0.3502	0.3592	0.3706	0.3811	

epoch 11    train auc: 0.9467  acc: 0.8722    eval auc: 0.9123  acc: 0.8372    test auc: 0.9125  acc: 0.8370, pre: 0.8218, rec: 0.8613, f1: 0.8411
epoch 12    train auc: 0.9478  acc: 0.8738    eval auc: 0.9121  acc: 0.8378    test auc: 0.9123  acc: 0.8363, pre: 0.8236, rec: 0.8565, f1: 0.8397
precision: 0.1343	0.1223	0.1084	0.0996	0.0926	0.0838	0.0717	
recall: 0.0252	0.0571	0.0993	0.1356	0.1659	0.2221	0.3095	
f1: 0.0425	0.0778	0.1036	0.1149	0.1189	0.1217	0.1165	
ndcg: 0.2015	0.2804	0.3250	0.3431	0.3526	0.3650	0.3759	

epoch 13    train auc: 0.9483  acc: 0.8744    eval auc: 0.9129  acc: 0.8383    test auc: 0.9135  acc: 0.8385, pre: 0.8239, rec: 0.8616, f1: 0.8423
precision: 0.1424	0.1258	0.1129	0.1042	0.0970	0.0864	0.0734	
recall: 0.0263	0.0593	0.1045	0.1413	0.1741	0.2285	0.3175	
f1: 0.0444	0.0806	0.1085	0.1199	0.1246	0.1254	0.1192	
ndcg: 0.2115	0.2882	0.3310	0.3494	0.3600	0.3711	0.3824	

epoch 14    train auc: 0.9488  acc: 0.8750    eval auc: 0.9135  acc: 0.8389    test auc: 0.9139  acc: 0.8391, pre: 0.8251, rec: 0.8612, f1: 0.8427
precision: 0.1473	0.1310	0.1151	0.1048	0.0978	0.0863	0.0735	
recall: 0.0275	0.0623	0.1080	0.1438	0.1764	0.2287	0.3164	
f1: 0.0464	0.0845	0.1114	0.1213	0.1258	0.1253	0.1193	
ndcg: 0.2205	0.2981	0.3414	0.3577	0.3664	0.3762	0.3861	

epoch 15    train auc: 0.9495  acc: 0.8756    eval auc: 0.9127  acc: 0.8380    test auc: 0.9131  acc: 0.8384, pre: 0.8288, rec: 0.8536, f1: 0.8410
epoch 16    train auc: 0.9497  acc: 0.8766    eval auc: 0.9133  acc: 0.8385    test auc: 0.9137  acc: 0.8388, pre: 0.8274, rec: 0.8569, f1: 0.8419
epoch 17    train auc: 0.9500  acc: 0.8769    eval auc: 0.9138  acc: 0.8386    test auc: 0.9141  acc: 0.8393, pre: 0.8284, rec: 0.8566, f1: 0.8423
epoch 18    train auc: 0.9500  acc: 0.8767    eval auc: 0.9134  acc: 0.8389    test auc: 0.9142  acc: 0.8393, pre: 0.8271, rec: 0.8585, f1: 0.8425
precision: 0.1433	0.1281	0.1139	0.1040	0.0968	0.0864	0.0733	
recall: 0.0269	0.0587	0.1029	0.1407	0.1728	0.2259	0.3134	
f1: 0.0453	0.0805	0.1081	0.1196	0.1241	0.1250	0.1188	
ndcg: 0.2175	0.2946	0.3350	0.3539	0.3640	0.3743	0.3838	

epoch 19    train auc: 0.9508  acc: 0.8777    eval auc: 0.9136  acc: 0.8392    test auc: 0.9141  acc: 0.8400, pre: 0.8259, rec: 0.8621, f1: 0.8436
precision: 0.1398	0.1241	0.1098	0.1024	0.0961	0.0861	0.0736	
recall: 0.0268	0.0586	0.1013	0.1388	0.1714	0.2260	0.3149	
f1: 0.0450	0.0796	0.1054	0.1178	0.1232	0.1247	0.1193	
ndcg: 0.2098	0.2883	0.3297	0.3489	0.3579	0.3692	0.3797	

/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 19:34:50.077559 139772778706688 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 19:34:50.097090 139772778706688 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 19:34:50.097826 139772778706688 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 19:34:50.137983 139772778706688 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 19:34:50.193978 139772778706688 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 19:34:50.196203 139772778706688 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 19:34:50.235031 139772778706688 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 19:34:50.256213 139772778706688 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 19:34:52.130053 139772778706688 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 19:34:52.132363: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 19:34:52.141467: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:34:52.141662: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:34:52.142714: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:34:52.143793: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:34:52.144062: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:34:52.145306: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:34:52.146569: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:34:52.150703: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:34:52.152680: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:34:52.153332: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 19:34:52.270183: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55794bfe25e0 executing computations on platform CUDA. Devices:
2020-01-07 19:34:52.270243: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 19:34:52.293496: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 19:34:52.295683: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55794c0da460 executing computations on platform Host. Devices:
2020-01-07 19:34:52.295712: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 19:34:52.296991: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:34:52.297047: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:34:52.297061: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:34:52.297073: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:34:52.297085: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:34:52.297097: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:34:52.297109: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:34:52.297121: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:34:52.299068: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:34:52.299110: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:34:52.300728: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 19:34:52.300747: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 19:34:52.300755: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 19:34:52.303127: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 19:34:52.305840 139772778706688 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 19:34:54.203481: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=1, batch_size=4096, dataset='movie', dim=8, gpu_id='0', kge_interval=3, l2_weight=1e-06, lr_kge=0.01, lr_rs=0.02, n_epochs=20)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.8891  acc: 0.8055    eval auc: 0.8831  acc: 0.8017    test auc: 0.8837  acc: 0.8015, pre: 0.8030, rec: 0.7999, f1: 0.8014
precision: 0.1219	0.1075	0.0991	0.0903	0.0832	0.0734	0.0618	
recall: 0.0241	0.0536	0.0966	0.1294	0.1557	0.2013	0.2778	
f1: 0.0403	0.0715	0.0978	0.1063	0.1084	0.1076	0.1011	
ndcg: 0.1782	0.2553	0.3028	0.3218	0.3305	0.3417	0.3547	

epoch 1    train auc: 0.8971  acc: 0.8127    eval auc: 0.8860  acc: 0.8048    test auc: 0.8867  acc: 0.8052, pre: 0.7909, rec: 0.8306, f1: 0.8102
precision: 0.1163	0.1080	0.1021	0.0941	0.0859	0.0755	0.0630	
recall: 0.0230	0.0542	0.0980	0.1329	0.1623	0.2090	0.2821	
f1: 0.0384	0.0722	0.1000	0.1102	0.1123	0.1109	0.1031	
ndcg: 0.1794	0.2593	0.3093	0.3291	0.3400	0.3510	0.3602	

epoch 2    train auc: 0.9067  acc: 0.8214    eval auc: 0.8895  acc: 0.8088    test auc: 0.8900  acc: 0.8088, pre: 0.7912, rec: 0.8397, f1: 0.8147
precision: 0.1249	0.1090	0.0990	0.0938	0.0869	0.0772	0.0648	
recall: 0.0245	0.0522	0.0927	0.1315	0.1638	0.2136	0.2899	
f1: 0.0410	0.0706	0.0958	0.1095	0.1135	0.1134	0.1059	
ndcg: 0.1905	0.2645	0.3098	0.3298	0.3423	0.3542	0.3631	

epoch 3    train auc: 0.9199  acc: 0.8377    eval auc: 0.8976  acc: 0.8175    test auc: 0.8984  acc: 0.8187, pre: 0.8118, rec: 0.8304, f1: 0.8210
precision: 0.1075	0.1071	0.1014	0.0946	0.0888	0.0791	0.0668	
recall: 0.0204	0.0513	0.0983	0.1340	0.1655	0.2192	0.2984	
f1: 0.0343	0.0694	0.0998	0.1109	0.1156	0.1162	0.1091	
ndcg: 0.1615	0.2443	0.2982	0.3205	0.3328	0.3472	0.3587	

epoch 4    train auc: 0.9287  acc: 0.8483    eval auc: 0.9034  acc: 0.8259    test auc: 0.9043  acc: 0.8271, pre: 0.8118, rec: 0.8524, f1: 0.8316
precision: 0.1308	0.1168	0.1032	0.0947	0.0894	0.0804	0.0683	
recall: 0.0254	0.0561	0.0976	0.1324	0.1629	0.2169	0.2973	
f1: 0.0426	0.0758	0.1003	0.1104	0.1155	0.1173	0.1110	
ndcg: 0.1940	0.2679	0.3124	0.3323	0.3437	0.3561	0.3673	

epoch 5    train auc: 0.9340  acc: 0.8556    eval auc: 0.9063  acc: 0.8295    test auc: 0.9072  acc: 0.8301, pre: 0.8119, rec: 0.8600, f1: 0.8353
precision: 0.1342	0.1236	0.1100	0.1007	0.0942	0.0827	0.0700	
recall: 0.0260	0.0606	0.1051	0.1420	0.1742	0.2241	0.3071	
f1: 0.0435	0.0814	0.1075	0.1178	0.1223	0.1208	0.1140	
ndcg: 0.2024	0.2847	0.3297	0.3476	0.3570	0.3672	0.3772	

epoch 6    train auc: 0.9376  acc: 0.8599    eval auc: 0.9064  acc: 0.8306    test auc: 0.9072  acc: 0.8314, pre: 0.8183, rec: 0.8527, f1: 0.8351
precision: 0.1113	0.1079	0.1009	0.0945	0.0893	0.0804	0.0686	
recall: 0.0213	0.0511	0.0937	0.1296	0.1626	0.2172	0.3017	
f1: 0.0357	0.0694	0.0971	0.1093	0.1153	0.1173	0.1118	
ndcg: 0.1692	0.2500	0.3000	0.3219	0.3339	0.3475	0.3606	

epoch 7    train auc: 0.9403  acc: 0.8634    eval auc: 0.9082  acc: 0.8321    test auc: 0.9092  acc: 0.8339, pre: 0.8178, rec: 0.8599, f1: 0.8383
precision: 0.1282	0.1184	0.1040	0.0966	0.0905	0.0819	0.0706	
recall: 0.0247	0.0576	0.0979	0.1330	0.1633	0.2173	0.3059	
f1: 0.0414	0.0775	0.1009	0.1119	0.1165	0.1189	0.1147	
ndcg: 0.1915	0.2746	0.3187	0.3363	0.3466	0.3572	0.3698	

epoch 8    train auc: 0.9423  acc: 0.8659    eval auc: 0.9093  acc: 0.8336    test auc: 0.9101  acc: 0.8346, pre: 0.8205, rec: 0.8573, f1: 0.8385
precision: 0.1369	0.1219	0.1090	0.0992	0.0921	0.0826	0.0707	
recall: 0.0265	0.0572	0.0997	0.1350	0.1665	0.2192	0.3067	
f1: 0.0444	0.0778	0.1041	0.1144	0.1186	0.1200	0.1149	
ndcg: 0.2027	0.2784	0.3250	0.3431	0.3523	0.3641	0.3746	

epoch 9    train auc: 0.9431  acc: 0.8669    eval auc: 0.9091  acc: 0.8331    test auc: 0.9098  acc: 0.8336, pre: 0.8270, rec: 0.8442, f1: 0.8355
epoch 10    train auc: 0.9446  acc: 0.8690    eval auc: 0.9104  acc: 0.8350    test auc: 0.9110  acc: 0.8351, pre: 0.8218, rec: 0.8563, f1: 0.8387
precision: 0.1309	0.1189	0.1075	0.0994	0.0934	0.0837	0.0717	
recall: 0.0250	0.0559	0.0997	0.1376	0.1690	0.2225	0.3086	
f1: 0.0420	0.0760	0.1035	0.1154	0.1204	0.1216	0.1163	
ndcg: 0.1980	0.2779	0.3217	0.3420	0.3528	0.3635	0.3737	

epoch 11    train auc: 0.9456  acc: 0.8702    eval auc: 0.9101  acc: 0.8352    test auc: 0.9109  acc: 0.8360, pre: 0.8193, rec: 0.8627, f1: 0.8404
precision: 0.1270	0.1148	0.1052	0.0970	0.0913	0.0829	0.0710	
recall: 0.0239	0.0542	0.0971	0.1334	0.1649	0.2211	0.3060	
f1: 0.0402	0.0736	0.1010	0.1123	0.1175	0.1205	0.1153	
ndcg: 0.1899	0.2659	0.3127	0.3341	0.3457	0.3579	0.3696	

epoch 12    train auc: 0.9458  acc: 0.8690    eval auc: 0.9104  acc: 0.8343    test auc: 0.9112  acc: 0.8350, pre: 0.8334, rec: 0.8380, f1: 0.8357
epoch 13    train auc: 0.9471  acc: 0.8721    eval auc: 0.9109  acc: 0.8358    test auc: 0.9120  acc: 0.8367, pre: 0.8205, rec: 0.8626, f1: 0.8410
precision: 0.1302	0.1194	0.1078	0.1004	0.0938	0.0848	0.0725	
recall: 0.0248	0.0564	0.1009	0.1375	0.1684	0.2241	0.3107	
f1: 0.0417	0.0767	0.1042	0.1161	0.1205	0.1231	0.1176	
ndcg: 0.1944	0.2742	0.3206	0.3407	0.3510	0.3636	0.3743	

epoch 14    train auc: 0.9477  acc: 0.8730    eval auc: 0.9118  acc: 0.8362    test auc: 0.9128  acc: 0.8376, pre: 0.8219, rec: 0.8627, f1: 0.8418
precision: 0.1394	0.1252	0.1119	0.1032	0.0966	0.0861	0.0730	
recall: 0.0259	0.0576	0.1008	0.1382	0.1719	0.2249	0.3112	
f1: 0.0437	0.0789	0.1061	0.1181	0.1237	0.1246	0.1183	
ndcg: 0.2094	0.2852	0.3298	0.3484	0.3584	0.3682	0.3800	

epoch 15    train auc: 0.9477  acc: 0.8730    eval auc: 0.9112  acc: 0.8354    test auc: 0.9122  acc: 0.8371, pre: 0.8289, rec: 0.8500, f1: 0.8394
epoch 16    train auc: 0.9485  acc: 0.8741    eval auc: 0.9118  acc: 0.8369    test auc: 0.9129  acc: 0.8383, pre: 0.8245, rec: 0.8602, f1: 0.8420
precision: 0.1378	0.1237	0.1093	0.1009	0.0943	0.0850	0.0725	
recall: 0.0257	0.0577	0.1001	0.1366	0.1687	0.2213	0.3065	
f1: 0.0434	0.0787	0.1045	0.1161	0.1210	0.1229	0.1173	
ndcg: 0.2056	0.2836	0.3266	0.3451	0.3552	0.3664	0.3758	

epoch 17    train auc: 0.9490  acc: 0.8746    eval auc: 0.9122  acc: 0.8370    test auc: 0.9134  acc: 0.8388, pre: 0.8279, rec: 0.8559, f1: 0.8417
precision: 0.1258	0.1174	0.1073	0.0986	0.0928	0.0845	0.0728	
recall: 0.0229	0.0534	0.0963	0.1324	0.1647	0.2215	0.3105	
f1: 0.0388	0.0735	0.1015	0.1130	0.1188	0.1223	0.1179	
ndcg: 0.1920	0.2711	0.3162	0.3351	0.3469	0.3595	0.3712	

epoch 18    train auc: 0.9494  acc: 0.8754    eval auc: 0.9124  acc: 0.8376    test auc: 0.9131  acc: 0.8389, pre: 0.8220, rec: 0.8659, f1: 0.8434
precision: 0.1349	0.1242	0.1100	0.1024	0.0964	0.0858	0.0732	
recall: 0.0250	0.0570	0.0995	0.1377	0.1712	0.2241	0.3110	
f1: 0.0422	0.0782	0.1045	0.1175	0.1234	0.1241	0.1184	
ndcg: 0.2017	0.2797	0.3241	0.3432	0.3545	0.3660	0.3770	

epoch 19    train auc: 0.9499  acc: 0.8762    eval auc: 0.9124  acc: 0.8375    test auc: 0.9137  acc: 0.8395, pre: 0.8208, rec: 0.8693, f1: 0.8443
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 19:42:55.065612 139721396115200 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 19:42:55.083867 139721396115200 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 19:42:55.084534 139721396115200 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 19:42:55.119177 139721396115200 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 19:42:55.168757 139721396115200 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 19:42:55.170704 139721396115200 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 19:42:55.205867 139721396115200 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 19:42:55.225882 139721396115200 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 19:42:56.978994 139721396115200 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 19:42:56.981247: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 19:42:56.990364: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:42:56.990573: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:42:56.991655: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:42:56.992626: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:42:56.992882: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:42:56.994225: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:42:56.995346: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:42:56.999126: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:42:57.000952: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:42:57.001676: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 19:42:57.114093: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55f33e8ce7e0 executing computations on platform CUDA. Devices:
2020-01-07 19:42:57.114153: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 19:42:57.133501: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 19:42:57.135751: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55f33e9c66b0 executing computations on platform Host. Devices:
2020-01-07 19:42:57.135801: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 19:42:57.137048: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:42:57.137108: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:42:57.137123: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:42:57.137137: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:42:57.137150: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:42:57.137164: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:42:57.137177: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:42:57.137191: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:42:57.139240: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:42:57.139283: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:42:57.140873: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 19:42:57.140887: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 19:42:57.140896: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 19:42:57.143451: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 19:42:57.146672 139721396115200 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 19:42:59.112514: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=1, batch_size=4096, dataset='movie', dim=8, gpu_id='0', kge_interval=3, l2_weight=1e-06, lr_kge=0.01, lr_rs=0.02, n_epochs=20)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.8902  acc: 0.8048    eval auc: 0.8839  acc: 0.8011    test auc: 0.8844  acc: 0.8009, pre: 0.8060, rec: 0.7934, f1: 0.7997
precision: 0.1172	0.1089	0.1007	0.0914	0.0831	0.0719	0.0608	
recall: 0.0216	0.0503	0.0943	0.1277	0.1520	0.1948	0.2674	
f1: 0.0365	0.0688	0.0974	0.1066	0.1075	0.1051	0.0990	
ndcg: 0.1708	0.2480	0.2956	0.3155	0.3249	0.3374	0.3483	

epoch 1    train auc: 0.8993  acc: 0.8137    eval auc: 0.8863  acc: 0.8050    test auc: 0.8869  acc: 0.8043, pre: 0.7970, rec: 0.8173, f1: 0.8070
precision: 0.1206	0.1065	0.0981	0.0920	0.0861	0.0753	0.0626	
recall: 0.0224	0.0493	0.0893	0.1268	0.1603	0.2086	0.2809	
f1: 0.0378	0.0674	0.0935	0.1066	0.1120	0.1107	0.1023	
ndcg: 0.1840	0.2565	0.3030	0.3232	0.3343	0.3480	0.3584	

epoch 2    train auc: 0.9129  acc: 0.8290    eval auc: 0.8927  acc: 0.8143    test auc: 0.8937  acc: 0.8143, pre: 0.7954, rec: 0.8471, f1: 0.8204
precision: 0.1124	0.1123	0.1038	0.0950	0.0883	0.0782	0.0644	
recall: 0.0212	0.0537	0.1006	0.1352	0.1631	0.2150	0.2853	
f1: 0.0357	0.0727	0.1022	0.1116	0.1146	0.1147	0.1051	
ndcg: 0.1704	0.2562	0.3074	0.3270	0.3378	0.3509	0.3606	

epoch 3    train auc: 0.9250  acc: 0.8428    eval auc: 0.9005  acc: 0.8215    test auc: 0.9020  acc: 0.8229, pre: 0.8179, rec: 0.8313, f1: 0.8246
precision: 0.1280	0.1195	0.1044	0.0961	0.0894	0.0794	0.0677	
recall: 0.0236	0.0565	0.0984	0.1340	0.1639	0.2140	0.2970	
f1: 0.0399	0.0767	0.1013	0.1119	0.1157	0.1158	0.1103	
ndcg: 0.1926	0.2732	0.3177	0.3373	0.3468	0.3588	0.3685	

epoch 4    train auc: 0.9333  acc: 0.8542    eval auc: 0.9048  acc: 0.8276    test auc: 0.9059  acc: 0.8280, pre: 0.8150, rec: 0.8492, f1: 0.8318
precision: 0.1378	0.1264	0.1134	0.1023	0.0945	0.0836	0.0696	
recall: 0.0267	0.0594	0.1071	0.1443	0.1768	0.2285	0.3063	
f1: 0.0447	0.0808	0.1102	0.1197	0.1232	0.1224	0.1134	
ndcg: 0.2085	0.2880	0.3341	0.3510	0.3607	0.3714	0.3793	

epoch 5    train auc: 0.9384  acc: 0.8608    eval auc: 0.9070  acc: 0.8306    test auc: 0.9079  acc: 0.8312, pre: 0.8122, rec: 0.8624, f1: 0.8365
precision: 0.1297	0.1204	0.1081	0.1001	0.0927	0.0825	0.0697	
recall: 0.0248	0.0579	0.1021	0.1403	0.1710	0.2220	0.3031	
f1: 0.0416	0.0782	0.1050	0.1168	0.1202	0.1203	0.1133	
ndcg: 0.1948	0.2762	0.3226	0.3424	0.3531	0.3629	0.3724	

epoch 6    train auc: 0.9415  acc: 0.8642    eval auc: 0.9081  acc: 0.8312    test auc: 0.9092  acc: 0.8318, pre: 0.8274, rec: 0.8390, f1: 0.8332
precision: 0.1349	0.1191	0.1059	0.0971	0.0904	0.0819	0.0700	
recall: 0.0255	0.0568	0.1004	0.1364	0.1657	0.2213	0.3064	
f1: 0.0428	0.0769	0.1031	0.1135	0.1169	0.1196	0.1139	
ndcg: 0.1997	0.2742	0.3198	0.3387	0.3485	0.3605	0.3717	

epoch 7    train auc: 0.9438  acc: 0.8681    eval auc: 0.9098  acc: 0.8334    test auc: 0.9105  acc: 0.8343, pre: 0.8236, rec: 0.8515, f1: 0.8373
precision: 0.1361	0.1219	0.1081	0.0994	0.0930	0.0832	0.0711	
recall: 0.0264	0.0561	0.1007	0.1363	0.1681	0.2219	0.3078	
f1: 0.0442	0.0769	0.1042	0.1149	0.1198	0.1210	0.1156	
ndcg: 0.2058	0.2804	0.3263	0.3442	0.3541	0.3656	0.3765	

epoch 8    train auc: 0.9458  acc: 0.8709    eval auc: 0.9100  acc: 0.8346    test auc: 0.9109  acc: 0.8344, pre: 0.8233, rec: 0.8522, f1: 0.8375
precision: 0.1356	0.1199	0.1061	0.0974	0.0904	0.0812	0.0703	
recall: 0.0259	0.0570	0.0981	0.1338	0.1649	0.2166	0.3047	
f1: 0.0434	0.0772	0.1020	0.1128	0.1168	0.1181	0.1143	
ndcg: 0.2031	0.2773	0.3215	0.3401	0.3517	0.3630	0.3734	

epoch 9    train auc: 0.9473  acc: 0.8727    eval auc: 0.9101  acc: 0.8336    test auc: 0.9108  acc: 0.8342, pre: 0.8270, rec: 0.8459, f1: 0.8363
epoch 10    train auc: 0.9488  acc: 0.8756    eval auc: 0.9117  acc: 0.8360    test auc: 0.9122  acc: 0.8360, pre: 0.8195, rec: 0.8626, f1: 0.8405
precision: 0.1291	0.1203	0.1074	0.0994	0.0938	0.0843	0.0723	
recall: 0.0254	0.0570	0.0999	0.1366	0.1702	0.2249	0.3145	
f1: 0.0424	0.0773	0.1035	0.1150	0.1209	0.1227	0.1176	
ndcg: 0.1949	0.2772	0.3213	0.3407	0.3523	0.3641	0.3757	

epoch 11    train auc: 0.9498  acc: 0.8763    eval auc: 0.9120  acc: 0.8373    test auc: 0.9126  acc: 0.8378, pre: 0.8177, rec: 0.8702, f1: 0.8431
precision: 0.1319	0.1153	0.1041	0.0966	0.0906	0.0822	0.0711	
recall: 0.0247	0.0528	0.0929	0.1289	0.1607	0.2182	0.3074	
f1: 0.0415	0.0724	0.0982	0.1105	0.1159	0.1194	0.1155	
ndcg: 0.1996	0.2734	0.3174	0.3364	0.3466	0.3593	0.3705	

epoch 12    train auc: 0.9503  acc: 0.8776    eval auc: 0.9127  acc: 0.8369    test auc: 0.9128  acc: 0.8362, pre: 0.8297, rec: 0.8466, f1: 0.8381
epoch 13    train auc: 0.9521  acc: 0.8799    eval auc: 0.9132  acc: 0.8387    test auc: 0.9137  acc: 0.8387, pre: 0.8216, rec: 0.8659, f1: 0.8431
precision: 0.1225	0.1138	0.1044	0.0981	0.0924	0.0836	0.0722	
recall: 0.0232	0.0519	0.0945	0.1314	0.1643	0.2192	0.3081	
f1: 0.0390	0.0713	0.0992	0.1124	0.1182	0.1210	0.1170	
ndcg: 0.1826	0.2586	0.3078	0.3288	0.3409	0.3537	0.3665	

epoch 14    train auc: 0.9526  acc: 0.8807    eval auc: 0.9132  acc: 0.8382    test auc: 0.9137  acc: 0.8393, pre: 0.8236, rec: 0.8641, f1: 0.8434
epoch 15    train auc: 0.9531  acc: 0.8811    eval auc: 0.9140  acc: 0.8384    test auc: 0.9144  acc: 0.8388, pre: 0.8330, rec: 0.8482, f1: 0.8405
epoch 16    train auc: 0.9539  acc: 0.8826    eval auc: 0.9144  acc: 0.8391    test auc: 0.9148  acc: 0.8399, pre: 0.8268, rec: 0.8604, f1: 0.8433
precision: 0.1338	0.1241	0.1119	0.1025	0.0958	0.0862	0.0733	
recall: 0.0249	0.0577	0.1029	0.1396	0.1721	0.2295	0.3155	
f1: 0.0419	0.0788	0.1072	0.1182	0.1231	0.1253	0.1189	
ndcg: 0.1993	0.2808	0.3285	0.3468	0.3572	0.3688	0.3781	

epoch 17    train auc: 0.9548  acc: 0.8835    eval auc: 0.9141  acc: 0.8400    test auc: 0.9147  acc: 0.8402, pre: 0.8208, rec: 0.8710, f1: 0.8451
precision: 0.1323	0.1197	0.1088	0.1000	0.0935	0.0842	0.0727	
recall: 0.0252	0.0557	0.0981	0.1350	0.1681	0.2226	0.3118	
f1: 0.0423	0.0761	0.1031	0.1149	0.1202	0.1221	0.1179	
ndcg: 0.2017	0.2789	0.3226	0.3417	0.3526	0.3643	0.3749	

epoch 18    train auc: 0.9549  acc: 0.8841    eval auc: 0.9135  acc: 0.8396    test auc: 0.9143  acc: 0.8406, pre: 0.8292, rec: 0.8584, f1: 0.8435
epoch 19    train auc: 0.9557  acc: 0.8851    eval auc: 0.9146  acc: 0.8401    test auc: 0.9151  acc: 0.8409, pre: 0.8245, rec: 0.8669, f1: 0.8452
precision: 0.1298	0.1212	0.1100	0.1011	0.0947	0.0849	0.0732	
recall: 0.0245	0.0553	0.0988	0.1358	0.1677	0.2233	0.3130	
f1: 0.0413	0.0760	0.1041	0.1159	0.1210	0.1230	0.1186	
ndcg: 0.1917	0.2711	0.3181	0.3378	0.3485	0.3617	0.3738	

/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 19:50:37.990869 139822382634752 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 19:50:38.011030 139822382634752 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 19:50:38.011772 139822382634752 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 19:50:38.050706 139822382634752 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 19:50:38.107614 139822382634752 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 19:50:38.109741 139822382634752 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 19:50:38.149465 139822382634752 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 19:50:38.172063 139822382634752 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 19:50:40.179723 139822382634752 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 19:50:40.182485: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 19:50:40.191825: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:50:40.192024: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:50:40.193110: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:50:40.194352: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:50:40.194660: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:50:40.196102: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:50:40.197363: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:50:40.201481: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:50:40.203437: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:50:40.204149: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 19:50:40.349363: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55d74a5bc0b0 executing computations on platform CUDA. Devices:
2020-01-07 19:50:40.349429: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 19:50:40.369530: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 19:50:40.371971: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55d74a6b3f10 executing computations on platform Host. Devices:
2020-01-07 19:50:40.372029: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 19:50:40.381925: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:50:40.382018: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:50:40.382037: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:50:40.382051: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:50:40.382064: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:50:40.382078: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:50:40.382101: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:50:40.382115: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:50:40.384055: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:50:40.384095: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:50:40.385577: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 19:50:40.385593: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 19:50:40.385602: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 19:50:40.387900: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 19:50:40.390961 139822382634752 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 19:50:42.293309: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=1, batch_size=4096, dataset='movie', dim=8, gpu_id='0', kge_interval=3, l2_weight=1e-06, lr_kge=0.01, lr_rs=0.02, n_epochs=20)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.8904  acc: 0.8054    eval auc: 0.8839  acc: 0.8015    test auc: 0.8843  acc: 0.8022, pre: 0.8037, rec: 0.8006, f1: 0.8021
precision: 0.1005	0.0990	0.0935	0.0852	0.0790	0.0737	0.0616	
recall: 0.0179	0.0466	0.0889	0.1214	0.1473	0.2038	0.2770	
f1: 0.0304	0.0633	0.0912	0.1002	0.1029	0.1082	0.1008	
ndcg: 0.1540	0.2329	0.2850	0.3060	0.3173	0.3330	0.3457	

epoch 1    train auc: 0.9049  acc: 0.8212    eval auc: 0.8913  acc: 0.8116    test auc: 0.8918  acc: 0.8120, pre: 0.7912, rec: 0.8483, f1: 0.8188
precision: 0.1284	0.1152	0.1030	0.0956	0.0889	0.0777	0.0642	
recall: 0.0241	0.0519	0.0928	0.1296	0.1630	0.2142	0.2851	
f1: 0.0405	0.0716	0.0976	0.1101	0.1150	0.1140	0.1048	
ndcg: 0.1936	0.2662	0.3078	0.3287	0.3412	0.3543	0.3641	

epoch 2    train auc: 0.9176  acc: 0.8363    eval auc: 0.8990  acc: 0.8218    test auc: 0.8996  acc: 0.8219, pre: 0.8020, rec: 0.8557, f1: 0.8280
precision: 0.1295	0.1175	0.1060	0.0985	0.0919	0.0804	0.0675	
recall: 0.0247	0.0549	0.0979	0.1362	0.1692	0.2171	0.2938	
f1: 0.0415	0.0748	0.1018	0.1144	0.1191	0.1174	0.1098	
ndcg: 0.1976	0.2747	0.3209	0.3394	0.3504	0.3611	0.3697	

epoch 3    train auc: 0.9258  acc: 0.8449    eval auc: 0.9024  acc: 0.8247    test auc: 0.9031  acc: 0.8249, pre: 0.8181, rec: 0.8363, f1: 0.8271
precision: 0.1303	0.1190	0.1071	0.0980	0.0919	0.0810	0.0681	
recall: 0.0250	0.0559	0.1003	0.1351	0.1677	0.2184	0.2975	
f1: 0.0419	0.0761	0.1036	0.1136	0.1188	0.1182	0.1108	
ndcg: 0.1979	0.2749	0.3227	0.3403	0.3501	0.3611	0.3715	

epoch 4    train auc: 0.9324  acc: 0.8534    eval auc: 0.9052  acc: 0.8286    test auc: 0.9060  acc: 0.8283, pre: 0.8159, rec: 0.8486, f1: 0.8319
precision: 0.1349	0.1230	0.1093	0.1000	0.0931	0.0817	0.0689	
recall: 0.0263	0.0582	0.1021	0.1387	0.1699	0.2202	0.3006	
f1: 0.0440	0.0790	0.1056	0.1162	0.1203	0.1192	0.1121	
ndcg: 0.2020	0.2837	0.3256	0.3440	0.3545	0.3655	0.3748	

epoch 5    train auc: 0.9375  acc: 0.8601    eval auc: 0.9076  acc: 0.8317    test auc: 0.9087  acc: 0.8315, pre: 0.8203, rec: 0.8495, f1: 0.8347
precision: 0.1281	0.1174	0.1076	0.0995	0.0924	0.0826	0.0699	
recall: 0.0238	0.0556	0.1019	0.1372	0.1691	0.2219	0.3021	
f1: 0.0402	0.0755	0.1047	0.1153	0.1195	0.1204	0.1135	
ndcg: 0.1944	0.2733	0.3219	0.3399	0.3506	0.3621	0.3721	

epoch 6    train auc: 0.9415  acc: 0.8650    eval auc: 0.9095  acc: 0.8341    test auc: 0.9101  acc: 0.8330, pre: 0.8259, rec: 0.8445, f1: 0.8351
precision: 0.1286	0.1194	0.1069	0.0988	0.0927	0.0831	0.0706	
recall: 0.0240	0.0557	0.0996	0.1362	0.1681	0.2215	0.3035	
f1: 0.0404	0.0760	0.1032	0.1145	0.1195	0.1209	0.1146	
ndcg: 0.1943	0.2732	0.3184	0.3364	0.3476	0.3609	0.3717	

epoch 7    train auc: 0.9447  acc: 0.8698    eval auc: 0.9113  acc: 0.8364    test auc: 0.9118  acc: 0.8359, pre: 0.8200, rec: 0.8613, f1: 0.8401
precision: 0.1308	0.1204	0.1082	0.1003	0.0945	0.0850	0.0720	
recall: 0.0240	0.0556	0.0993	0.1360	0.1709	0.2263	0.3104	
f1: 0.0406	0.0761	0.1035	0.1155	0.1217	0.1236	0.1169	
ndcg: 0.1973	0.2734	0.3201	0.3398	0.3513	0.3643	0.3744	

epoch 8    train auc: 0.9470  acc: 0.8724    eval auc: 0.9121  acc: 0.8375    test auc: 0.9127  acc: 0.8378, pre: 0.8219, rec: 0.8631, f1: 0.8420
precision: 0.1347	0.1200	0.1087	0.1011	0.0948	0.0852	0.0725	
recall: 0.0260	0.0561	0.1000	0.1385	0.1711	0.2268	0.3126	
f1: 0.0436	0.0764	0.1042	0.1169	0.1220	0.1239	0.1177	
ndcg: 0.2017	0.2798	0.3257	0.3460	0.3567	0.3682	0.3782	

epoch 9    train auc: 0.9485  acc: 0.8743    eval auc: 0.9128  acc: 0.8375    test auc: 0.9133  acc: 0.8377, pre: 0.8317, rec: 0.8474, f1: 0.8395
precision: 0.1236	0.1104	0.1028	0.0973	0.0928	0.0841	0.0724	
recall: 0.0235	0.0498	0.0916	0.1302	0.1660	0.2215	0.3119	
f1: 0.0394	0.0687	0.0969	0.1113	0.1190	0.1219	0.1175	
ndcg: 0.1901	0.2640	0.3119	0.3329	0.3458	0.3586	0.3700	

epoch 10    train auc: 0.9500  acc: 0.8771    eval auc: 0.9132  acc: 0.8386    test auc: 0.9139  acc: 0.8393, pre: 0.8223, rec: 0.8662, f1: 0.8437
precision: 0.1327	0.1181	0.1072	0.0998	0.0948	0.0853	0.0729	
recall: 0.0250	0.0543	0.0973	0.1363	0.1683	0.2250	0.3130	
f1: 0.0421	0.0744	0.1020	0.1152	0.1213	0.1237	0.1182	
ndcg: 0.2013	0.2766	0.3210	0.3415	0.3517	0.3646	0.3756	

epoch 11    train auc: 0.9510  acc: 0.8785    eval auc: 0.9139  acc: 0.8401    test auc: 0.9147  acc: 0.8398, pre: 0.8270, rec: 0.8599, f1: 0.8431
precision: 0.1339	0.1240	0.1096	0.1026	0.0963	0.0864	0.0735	
recall: 0.0254	0.0577	0.0994	0.1386	0.1726	0.2270	0.3130	
f1: 0.0427	0.0787	0.1043	0.1179	0.1237	0.1251	0.1191	
ndcg: 0.2011	0.2836	0.3252	0.3454	0.3556	0.3670	0.3784	

epoch 12    train auc: 0.9519  acc: 0.8794    eval auc: 0.9139  acc: 0.8393    test auc: 0.9143  acc: 0.8393, pre: 0.8309, rec: 0.8527, f1: 0.8417
epoch 13    train auc: 0.9530  acc: 0.8810    eval auc: 0.9145  acc: 0.8410    test auc: 0.9149  acc: 0.8406, pre: 0.8241, rec: 0.8665, f1: 0.8448
precision: 0.1293	0.1195	0.1092	0.1022	0.0955	0.0863	0.0739	
recall: 0.0235	0.0540	0.0999	0.1381	0.1689	0.2264	0.3148	
f1: 0.0398	0.0744	0.1043	0.1175	0.1220	0.1250	0.1197	
ndcg: 0.1939	0.2742	0.3209	0.3397	0.3506	0.3631	0.3746	

epoch 14    train auc: 0.9534  acc: 0.8815    eval auc: 0.9146  acc: 0.8407    test auc: 0.9153  acc: 0.8406, pre: 0.8279, rec: 0.8605, f1: 0.8439
epoch 15    train auc: 0.9539  acc: 0.8827    eval auc: 0.9136  acc: 0.8398    test auc: 0.9143  acc: 0.8403, pre: 0.8296, rec: 0.8570, f1: 0.8431
epoch 16    train auc: 0.9550  acc: 0.8837    eval auc: 0.9142  acc: 0.8408    test auc: 0.9147  acc: 0.8402, pre: 0.8246, rec: 0.8647, f1: 0.8442
epoch 17    train auc: 0.9549  acc: 0.8834    eval auc: 0.9142  acc: 0.8403    test auc: 0.9151  acc: 0.8415, pre: 0.8264, rec: 0.8653, f1: 0.8454
epoch 18    train auc: 0.9551  acc: 0.8840    eval auc: 0.9141  acc: 0.8404    test auc: 0.9150  acc: 0.8406, pre: 0.8276, rec: 0.8610, f1: 0.8439
epoch 19    train auc: 0.9558  acc: 0.8849    eval auc: 0.9145  acc: 0.8415    test auc: 0.9152  acc: 0.8419, pre: 0.8269, rec: 0.8652, f1: 0.8457
precision: 0.1297	0.1197	0.1101	0.1019	0.0949	0.0852	0.0730	
recall: 0.0239	0.0537	0.0980	0.1349	0.1661	0.2191	0.3084	
f1: 0.0404	0.0741	0.1037	0.1161	0.1208	0.1227	0.1181	
ndcg: 0.1964	0.2738	0.3202	0.3390	0.3491	0.3614	0.3726	

/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 19:57:52.010581 140041077249792 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 19:57:52.030788 140041077249792 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 19:57:52.031530 140041077249792 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 19:57:52.071558 140041077249792 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 19:57:52.129664 140041077249792 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 19:57:52.131872 140041077249792 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 19:57:52.171926 140041077249792 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 19:57:52.196145 140041077249792 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 19:57:54.230828 140041077249792 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 19:57:54.233163: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 19:57:54.242232: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:57:54.242416: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:57:54.243436: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:57:54.244508: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:57:54.244769: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:57:54.246027: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:57:54.247176: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:57:54.251245: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:57:54.253278: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:57:54.254036: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 19:57:54.368686: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x564bb360a5e0 executing computations on platform CUDA. Devices:
2020-01-07 19:57:54.368747: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 19:57:54.389555: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 19:57:54.391688: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x564bb3702460 executing computations on platform Host. Devices:
2020-01-07 19:57:54.391745: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 19:57:54.393015: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 19:57:54.393072: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:57:54.393086: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 19:57:54.393099: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 19:57:54.393111: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 19:57:54.393123: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 19:57:54.393135: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 19:57:54.393147: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 19:57:54.395081: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 19:57:54.395116: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 19:57:54.396532: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 19:57:54.396544: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 19:57:54.396551: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 19:57:54.398846: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 19:57:54.401577 140041077249792 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 19:57:56.340782: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=1, batch_size=4096, dataset='movie', dim=8, gpu_id='0', kge_interval=3, l2_weight=1e-06, lr_kge=0.01, lr_rs=0.02, n_epochs=20)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.8887  acc: 0.8039    eval auc: 0.8831  acc: 0.8008    test auc: 0.8835  acc: 0.7998, pre: 0.8051, rec: 0.7919, f1: 0.7985
precision: 0.1166	0.1085	0.1016	0.0911	0.0827	0.0727	0.0613	
recall: 0.0204	0.0518	0.0981	0.1312	0.1559	0.1999	0.2770	
f1: 0.0347	0.0702	0.0998	0.1075	0.1080	0.1066	0.1004	
ndcg: 0.1714	0.2484	0.3007	0.3188	0.3279	0.3386	0.3531	

epoch 1    train auc: 0.8942  acc: 0.8089    eval auc: 0.8851  acc: 0.8036    test auc: 0.8853  acc: 0.8032, pre: 0.7984, rec: 0.8121, f1: 0.8052
precision: 0.1275	0.1188	0.1040	0.0946	0.0876	0.0751	0.0626	
recall: 0.0239	0.0553	0.0969	0.1329	0.1653	0.2082	0.2816	
f1: 0.0402	0.0755	0.1003	0.1105	0.1145	0.1103	0.1025	
ndcg: 0.1954	0.2734	0.3141	0.3334	0.3440	0.3537	0.3640	

epoch 2    train auc: 0.9014  acc: 0.8155    eval auc: 0.8871  acc: 0.8055    test auc: 0.8877  acc: 0.8060, pre: 0.7904, rec: 0.8336, f1: 0.8114
precision: 0.1234	0.1118	0.0998	0.0915	0.0860	0.0770	0.0642	
recall: 0.0223	0.0532	0.0958	0.1302	0.1607	0.2110	0.2877	
f1: 0.0378	0.0721	0.0978	0.1075	0.1121	0.1129	0.1050	
ndcg: 0.1884	0.2597	0.3029	0.3238	0.3364	0.3494	0.3612	

epoch 3    train auc: 0.9191  acc: 0.8371    eval auc: 0.8983  acc: 0.8204    test auc: 0.8995  acc: 0.8211, pre: 0.8077, rec: 0.8437, f1: 0.8253
precision: 0.1348	0.1208	0.1088	0.0996	0.0920	0.0807	0.0669	
recall: 0.0264	0.0572	0.1022	0.1395	0.1719	0.2225	0.2952	
f1: 0.0441	0.0777	0.1054	0.1162	0.1198	0.1185	0.1091	
ndcg: 0.2049	0.2805	0.3247	0.3439	0.3555	0.3666	0.3746	

epoch 4    train auc: 0.9283  acc: 0.8485    eval auc: 0.9045  acc: 0.8273    test auc: 0.9056  acc: 0.8273, pre: 0.8187, rec: 0.8414, f1: 0.8299
precision: 0.1394	0.1260	0.1122	0.1018	0.0942	0.0830	0.0699	
recall: 0.0271	0.0604	0.1055	0.1436	0.1752	0.2271	0.3077	
f1: 0.0454	0.0817	0.1087	0.1192	0.1225	0.1216	0.1139	
ndcg: 0.2063	0.2828	0.3272	0.3463	0.3577	0.3697	0.3796	

epoch 5    train auc: 0.9348  acc: 0.8572    eval auc: 0.9073  acc: 0.8313    test auc: 0.9081  acc: 0.8314, pre: 0.8107, rec: 0.8653, f1: 0.8371
precision: 0.1310	0.1213	0.1089	0.0995	0.0924	0.0819	0.0698	
recall: 0.0252	0.0574	0.1030	0.1393	0.1708	0.2219	0.3040	
f1: 0.0423	0.0779	0.1059	0.1161	0.1199	0.1196	0.1136	
ndcg: 0.1996	0.2787	0.3235	0.3428	0.3535	0.3644	0.3749	

epoch 6    train auc: 0.9393  acc: 0.8623    eval auc: 0.9089  acc: 0.8328    test auc: 0.9100  acc: 0.8332, pre: 0.8257, rec: 0.8453, f1: 0.8354
precision: 0.1321	0.1195	0.1069	0.0990	0.0933	0.0841	0.0712	
recall: 0.0244	0.0555	0.0977	0.1346	0.1659	0.2242	0.3102	
f1: 0.0412	0.0758	0.1021	0.1141	0.1194	0.1223	0.1158	
ndcg: 0.2002	0.2760	0.3198	0.3399	0.3506	0.3640	0.3740	

epoch 7    train auc: 0.9430  acc: 0.8672    eval auc: 0.9109  acc: 0.8358    test auc: 0.9116  acc: 0.8351, pre: 0.8195, rec: 0.8601, f1: 0.8393
precision: 0.1343	0.1187	0.1091	0.1012	0.0951	0.0857	0.0723	
recall: 0.0247	0.0540	0.0984	0.1360	0.1705	0.2270	0.3126	
f1: 0.0417	0.0742	0.1035	0.1160	0.1221	0.1244	0.1174	
ndcg: 0.2040	0.2781	0.3224	0.3396	0.3513	0.3642	0.3757	

epoch 8    train auc: 0.9456  acc: 0.8706    eval auc: 0.9118  acc: 0.8362    test auc: 0.9130  acc: 0.8371, pre: 0.8268, rec: 0.8534, f1: 0.8399
precision: 0.1358	0.1222	0.1122	0.1027	0.0964	0.0858	0.0729	
recall: 0.0258	0.0574	0.1039	0.1405	0.1746	0.2294	0.3148	
f1: 0.0433	0.0781	0.1079	0.1187	0.1242	0.1249	0.1184	
ndcg: 0.2025	0.2811	0.3282	0.3468	0.3573	0.3694	0.3798	

epoch 9    train auc: 0.9469  acc: 0.8720    eval auc: 0.9136  acc: 0.8378    test auc: 0.9147  acc: 0.8393, pre: 0.8302, rec: 0.8537, f1: 0.8418
precision: 0.1352	0.1259	0.1121	0.1036	0.0966	0.0864	0.0736	
recall: 0.0246	0.0571	0.1027	0.1398	0.1740	0.2276	0.3160	
f1: 0.0416	0.0785	0.1072	0.1190	0.1242	0.1252	0.1195	
ndcg: 0.2047	0.2847	0.3284	0.3469	0.3575	0.3680	0.3795	

epoch 10    train auc: 0.9493  acc: 0.8759    eval auc: 0.9143  acc: 0.8393    test auc: 0.9153  acc: 0.8400, pre: 0.8223, rec: 0.8680, f1: 0.8446
precision: 0.1309	0.1250	0.1114	0.1032	0.0969	0.0873	0.0740	
recall: 0.0235	0.0561	0.1016	0.1370	0.1696	0.2271	0.3143	
f1: 0.0398	0.0774	0.1062	0.1177	0.1234	0.1261	0.1198	
ndcg: 0.1976	0.2787	0.3218	0.3410	0.3517	0.3644	0.3758	

epoch 11    train auc: 0.9507  acc: 0.8778    eval auc: 0.9149  acc: 0.8403    test auc: 0.9155  acc: 0.8406, pre: 0.8261, rec: 0.8635, f1: 0.8444
precision: 0.1373	0.1245	0.1129	0.1042	0.0969	0.0873	0.0744	
recall: 0.0262	0.0574	0.1049	0.1407	0.1720	0.2291	0.3183	
f1: 0.0440	0.0786	0.1088	0.1197	0.1240	0.1264	0.1207	
ndcg: 0.2119	0.2884	0.3341	0.3504	0.3596	0.3704	0.3823	

epoch 12    train auc: 0.9508  acc: 0.8778    eval auc: 0.9154  acc: 0.8408    test auc: 0.9161  acc: 0.8411, pre: 0.8280, rec: 0.8618, f1: 0.8445
precision: 0.1421	0.1271	0.1130	0.1032	0.0971	0.0870	0.0747	
recall: 0.0263	0.0591	0.1038	0.1403	0.1743	0.2306	0.3221	
f1: 0.0444	0.0806	0.1082	0.1189	0.1248	0.1263	0.1213	
ndcg: 0.2131	0.2935	0.3346	0.3518	0.3626	0.3743	0.3846	

epoch 13    train auc: 0.9518  acc: 0.8792    eval auc: 0.9158  acc: 0.8414    test auc: 0.9165  acc: 0.8418, pre: 0.8290, rec: 0.8619, f1: 0.8451
precision: 0.1405	0.1280	0.1152	0.1062	0.0991	0.0886	0.0753	
recall: 0.0258	0.0593	0.1048	0.1430	0.1749	0.2323	0.3210	
f1: 0.0436	0.0811	0.1097	0.1219	0.1266	0.1283	0.1220	
ndcg: 0.2095	0.2881	0.3321	0.3502	0.3596	0.3724	0.3827	

epoch 14    train auc: 0.9522  acc: 0.8797    eval auc: 0.9165  acc: 0.8420    test auc: 0.9170  acc: 0.8425, pre: 0.8311, rec: 0.8602, f1: 0.8454
precision: 0.1337	0.1271	0.1142	0.1045	0.0974	0.0879	0.0752	
recall: 0.0250	0.0589	0.1043	0.1421	0.1743	0.2305	0.3215	
f1: 0.0421	0.0805	0.1090	0.1204	0.1250	0.1273	0.1219	
ndcg: 0.2004	0.2829	0.3279	0.3457	0.3560	0.3685	0.3802	

epoch 15    train auc: 0.9521  acc: 0.8800    eval auc: 0.9165  acc: 0.8421    test auc: 0.9169  acc: 0.8423, pre: 0.8281, rec: 0.8647, f1: 0.8460
precision: 0.1367	0.1260	0.1142	0.1051	0.0980	0.0881	0.0752	
recall: 0.0250	0.0573	0.1038	0.1405	0.1720	0.2286	0.3219	
f1: 0.0423	0.0788	0.1087	0.1203	0.1249	0.1272	0.1220	
ndcg: 0.2067	0.2864	0.3304	0.3483	0.3591	0.3710	0.3820	

epoch 16    train auc: 0.9533  acc: 0.8818    eval auc: 0.9163  acc: 0.8427    test auc: 0.9169  acc: 0.8426, pre: 0.8280, rec: 0.8656, f1: 0.8464
precision: 0.1469	0.1290	0.1153	0.1057	0.0986	0.0884	0.0752	
recall: 0.0279	0.0595	0.1038	0.1415	0.1742	0.2282	0.3175	
f1: 0.0468	0.0814	0.1093	0.1210	0.1259	0.1275	0.1216	
ndcg: 0.2231	0.2974	0.3375	0.3557	0.3654	0.3755	0.3854	

epoch 17    train auc: 0.9534  acc: 0.8817    eval auc: 0.9167  acc: 0.8431    test auc: 0.9173  acc: 0.8429, pre: 0.8281, rec: 0.8659, f1: 0.8466
precision: 0.1468	0.1321	0.1170	0.1071	0.0994	0.0887	0.0750	
recall: 0.0273	0.0607	0.1076	0.1461	0.1779	0.2325	0.3189	
f1: 0.0461	0.0831	0.1121	0.1236	0.1276	0.1284	0.1214	
ndcg: 0.2218	0.3003	0.3414	0.3583	0.3675	0.3783	0.3878	

epoch 18    train auc: 0.9536  acc: 0.8818    eval auc: 0.9167  acc: 0.8430    test auc: 0.9168  acc: 0.8419, pre: 0.8279, rec: 0.8639, f1: 0.8455
epoch 19    train auc: 0.9538  acc: 0.8821    eval auc: 0.9168  acc: 0.8434    test auc: 0.9172  acc: 0.8434, pre: 0.8288, rec: 0.8662, f1: 0.8471
precision: 0.1390	0.1289	0.1167	0.1059	0.0982	0.0879	0.0749	
recall: 0.0259	0.0608	0.1067	0.1428	0.1749	0.2297	0.3191	
f1: 0.0436	0.0826	0.1115	0.1216	0.1258	0.1271	0.1213	
ndcg: 0.2060	0.2884	0.3333	0.3502	0.3596	0.3714	0.3830	

/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 20:07:00.015857 139955732276992 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 20:07:00.036891 139955732276992 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 20:07:00.037596 139955732276992 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 20:07:00.073922 139955732276992 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 20:07:00.125712 139955732276992 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 20:07:00.127602 139955732276992 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 20:07:00.164205 139955732276992 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 20:07:00.184870 139955732276992 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 20:07:01.954488 139955732276992 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 20:07:01.957592: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 20:07:01.966602: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 20:07:01.966784: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:07:01.967835: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 20:07:01.968928: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 20:07:01.969198: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 20:07:01.970418: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 20:07:01.971592: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 20:07:01.975402: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 20:07:01.977257: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 20:07:01.978459: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 20:07:02.103711: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x557eed9c0260 executing computations on platform CUDA. Devices:
2020-01-07 20:07:02.103819: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 20:07:02.125647: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 20:07:02.127632: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x557eedab80c0 executing computations on platform Host. Devices:
2020-01-07 20:07:02.127665: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 20:07:02.128911: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 20:07:02.128956: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:07:02.128968: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 20:07:02.128978: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 20:07:02.128988: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 20:07:02.128998: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 20:07:02.129008: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 20:07:02.129019: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 20:07:02.130796: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 20:07:02.130836: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:07:02.132164: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 20:07:02.132175: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 20:07:02.132181: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 20:07:02.134376: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 20:07:02.137320 139955732276992 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 20:07:03.791326: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=1, batch_size=4096, dataset='movie', dim=8, gpu_id='0', kge_interval=3, l2_weight=1e-06, lr_kge=0.01, lr_rs=0.02, n_epochs=20)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.8903  acc: 0.8055    eval auc: 0.8835  acc: 0.8023    test auc: 0.8837  acc: 0.8015, pre: 0.8013, rec: 0.8026, f1: 0.8019
precision: 0.1049	0.1076	0.0974	0.0896	0.0818	0.0723	0.0607	
recall: 0.0208	0.0518	0.0941	0.1306	0.1581	0.2036	0.2726	
f1: 0.0348	0.0700	0.0957	0.1063	0.1078	0.1067	0.0993	
ndcg: 0.1562	0.2387	0.2923	0.3150	0.3264	0.3404	0.3509	

epoch 1    train auc: 0.9009  acc: 0.8162    eval auc: 0.8880  acc: 0.8077    test auc: 0.8882  acc: 0.8070, pre: 0.7939, rec: 0.8298, f1: 0.8115
precision: 0.1104	0.1055	0.0966	0.0895	0.0842	0.0761	0.0637	
recall: 0.0215	0.0503	0.0928	0.1283	0.1596	0.2119	0.2870	
f1: 0.0360	0.0681	0.0947	0.1054	0.1102	0.1119	0.1042	
ndcg: 0.1716	0.2463	0.2969	0.3184	0.3309	0.3443	0.3555	

epoch 2    train auc: 0.9183  acc: 0.8367    eval auc: 0.8993  acc: 0.8204    test auc: 0.8990  acc: 0.8213, pre: 0.8065, rec: 0.8461, f1: 0.8258
precision: 0.1220	0.1127	0.1036	0.0951	0.0881	0.0785	0.0664	
recall: 0.0243	0.0530	0.0993	0.1352	0.1651	0.2161	0.2946	
f1: 0.0405	0.0721	0.1014	0.1117	0.1149	0.1152	0.1083	
ndcg: 0.1872	0.2677	0.3174	0.3370	0.3473	0.3580	0.3680	

epoch 3    train auc: 0.9271  acc: 0.8470    eval auc: 0.9048  acc: 0.8264    test auc: 0.9054  acc: 0.8272, pre: 0.8249, rec: 0.8314, f1: 0.8282
precision: 0.1357	0.1213	0.1061	0.0970	0.0900	0.0800	0.0677	
recall: 0.0283	0.0602	0.1020	0.1363	0.1664	0.2186	0.2991	
f1: 0.0469	0.0805	0.1040	0.1133	0.1168	0.1171	0.1104	
ndcg: 0.2028	0.2804	0.3230	0.3406	0.3516	0.3634	0.3740	

epoch 4    train auc: 0.9317  acc: 0.8535    eval auc: 0.9068  acc: 0.8302    test auc: 0.9074  acc: 0.8309, pre: 0.8166, rec: 0.8541, f1: 0.8349
precision: 0.1304	0.1223	0.1094	0.1007	0.0938	0.0836	0.0703	
recall: 0.0261	0.0604	0.1061	0.1451	0.1749	0.2265	0.3074	
f1: 0.0435	0.0809	0.1078	0.1189	0.1221	0.1222	0.1144	
ndcg: 0.1954	0.2798	0.3287	0.3484	0.3571	0.3687	0.3780	

epoch 5    train auc: 0.9354  acc: 0.8573    eval auc: 0.9078  acc: 0.8313    test auc: 0.9085  acc: 0.8319, pre: 0.8200, rec: 0.8511, f1: 0.8352
precision: 0.1381	0.1228	0.1106	0.1008	0.0931	0.0823	0.0697	
recall: 0.0287	0.0594	0.1061	0.1433	0.1742	0.2251	0.3055	
f1: 0.0475	0.0800	0.1083	0.1183	0.1214	0.1205	0.1134	
ndcg: 0.2107	0.2895	0.3339	0.3522	0.3615	0.3726	0.3815	

epoch 6    train auc: 0.9380  acc: 0.8611    eval auc: 0.9081  acc: 0.8312    test auc: 0.9089  acc: 0.8329, pre: 0.8200, rec: 0.8537, f1: 0.8365
epoch 7    train auc: 0.9399  acc: 0.8631    eval auc: 0.9090  acc: 0.8325    test auc: 0.9099  acc: 0.8325, pre: 0.8207, rec: 0.8515, f1: 0.8358
precision: 0.1461	0.1273	0.1119	0.1027	0.0955	0.0848	0.0716	
recall: 0.0288	0.0607	0.1044	0.1420	0.1740	0.2278	0.3106	
f1: 0.0481	0.0822	0.1080	0.1192	0.1233	0.1236	0.1163	
ndcg: 0.2220	0.2983	0.3392	0.3566	0.3655	0.3753	0.3853	

epoch 8    train auc: 0.9418  acc: 0.8659    eval auc: 0.9099  acc: 0.8338    test auc: 0.9106  acc: 0.8344, pre: 0.8198, rec: 0.8579, f1: 0.8384
precision: 0.1318	0.1244	0.1123	0.1037	0.0963	0.0854	0.0718	
recall: 0.0248	0.0593	0.1047	0.1422	0.1750	0.2300	0.3130	
f1: 0.0418	0.0803	0.1083	0.1199	0.1243	0.1246	0.1168	
ndcg: 0.2019	0.2859	0.3313	0.3484	0.3589	0.3696	0.3800	

epoch 9    train auc: 0.9427  acc: 0.8667    eval auc: 0.9094  acc: 0.8335    test auc: 0.9105  acc: 0.8344, pre: 0.8229, rec: 0.8528, f1: 0.8376
epoch 10    train auc: 0.9443  acc: 0.8685    eval auc: 0.9113  acc: 0.8357    test auc: 0.9120  acc: 0.8368, pre: 0.8251, rec: 0.8555, f1: 0.8400
precision: 0.1391	0.1263	0.1108	0.1023	0.0952	0.0854	0.0725	
recall: 0.0265	0.0582	0.1010	0.1393	0.1715	0.2265	0.3131	
f1: 0.0445	0.0796	0.1057	0.1180	0.1225	0.1240	0.1178	
ndcg: 0.2084	0.2865	0.3284	0.3483	0.3579	0.3694	0.3804	

epoch 11    train auc: 0.9453  acc: 0.8700    eval auc: 0.9114  acc: 0.8354    test auc: 0.9123  acc: 0.8366, pre: 0.8243, rec: 0.8561, f1: 0.8399
epoch 12    train auc: 0.9463  acc: 0.8712    eval auc: 0.9116  acc: 0.8365    test auc: 0.9125  acc: 0.8375, pre: 0.8311, rec: 0.8477, f1: 0.8393
precision: 0.1319	0.1182	0.1070	0.0981	0.0925	0.0833	0.0712	
recall: 0.0237	0.0527	0.0956	0.1310	0.1633	0.2187	0.3021	
f1: 0.0402	0.0729	0.1010	0.1122	0.1181	0.1207	0.1152	
ndcg: 0.1982	0.2728	0.3180	0.3364	0.3472	0.3596	0.3696	

epoch 13    train auc: 0.9471  acc: 0.8724    eval auc: 0.9123  acc: 0.8369    test auc: 0.9132  acc: 0.8380, pre: 0.8217, rec: 0.8639, f1: 0.8423
precision: 0.1303	0.1228	0.1115	0.1026	0.0959	0.0862	0.0734	
recall: 0.0238	0.0554	0.1022	0.1388	0.1705	0.2264	0.3140	
f1: 0.0403	0.0763	0.1066	0.1180	0.1227	0.1249	0.1190	
ndcg: 0.1986	0.2774	0.3264	0.3449	0.3545	0.3659	0.3762	

epoch 14    train auc: 0.9480  acc: 0.8740    eval auc: 0.9123  acc: 0.8374    test auc: 0.9134  acc: 0.8387, pre: 0.8249, rec: 0.8606, f1: 0.8424
precision: 0.1353	0.1232	0.1081	0.0997	0.0936	0.0846	0.0723	
recall: 0.0255	0.0566	0.0975	0.1349	0.1661	0.2218	0.3068	
f1: 0.0430	0.0775	0.1026	0.1146	0.1197	0.1225	0.1171	
ndcg: 0.2042	0.2844	0.3251	0.3444	0.3544	0.3660	0.3755	

epoch 15    train auc: 0.9486  acc: 0.8746    eval auc: 0.9129  acc: 0.8380    test auc: 0.9139  acc: 0.8383, pre: 0.8260, rec: 0.8578, f1: 0.8416
precision: 0.1377	0.1282	0.1141	0.1040	0.0971	0.0862	0.0735	
recall: 0.0259	0.0583	0.1033	0.1386	0.1708	0.2258	0.3132	
f1: 0.0436	0.0801	0.1084	0.1188	0.1238	0.1247	0.1191	
ndcg: 0.2050	0.2873	0.3324	0.3480	0.3585	0.3707	0.3804	

epoch 16    train auc: 0.9495  acc: 0.8760    eval auc: 0.9127  acc: 0.8374    test auc: 0.9138  acc: 0.8395, pre: 0.8241, rec: 0.8638, f1: 0.8435
epoch 17    train auc: 0.9493  acc: 0.8756    eval auc: 0.9141  acc: 0.8384    test auc: 0.9150  acc: 0.8393, pre: 0.8289, rec: 0.8557, f1: 0.8421
precision: 0.1399	0.1287	0.1154	0.1061	0.0986	0.0880	0.0748	
recall: 0.0252	0.0594	0.1061	0.1422	0.1746	0.2301	0.3204	
f1: 0.0428	0.0812	0.1105	0.1215	0.1260	0.1273	0.1213	
ndcg: 0.2074	0.2908	0.3357	0.3520	0.3615	0.3723	0.3833	

epoch 18    train auc: 0.9506  acc: 0.8777    eval auc: 0.9132  acc: 0.8383    test auc: 0.9140  acc: 0.8392, pre: 0.8276, rec: 0.8573, f1: 0.8422
epoch 19    train auc: 0.9509  acc: 0.8779    eval auc: 0.9140  acc: 0.8395    test auc: 0.9150  acc: 0.8403, pre: 0.8256, rec: 0.8635, f1: 0.8441
precision: 0.1345	0.1256	0.1135	0.1033	0.0961	0.0863	0.0736	
recall: 0.0250	0.0575	0.1026	0.1379	0.1688	0.2233	0.3115	
f1: 0.0422	0.0789	0.1078	0.1181	0.1225	0.1245	0.1191	
ndcg: 0.2037	0.2851	0.3308	0.3479	0.3568	0.3679	0.3795	

/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 20:14:22.093410 140696594089728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 20:14:22.119684 140696594089728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 20:14:22.120338 140696594089728 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 20:14:22.153922 140696594089728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 20:14:22.202104 140696594089728 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 20:14:22.203864 140696594089728 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 20:14:22.237787 140696594089728 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 20:14:22.257186 140696594089728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 20:14:23.956330 140696594089728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 20:14:23.958373: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 20:14:23.967143: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 20:14:23.967317: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:14:23.968347: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 20:14:23.969401: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 20:14:23.969673: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 20:14:23.970838: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 20:14:23.971970: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 20:14:23.975640: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 20:14:23.977518: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 20:14:23.978105: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 20:14:24.104600: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x56530fa524f0 executing computations on platform CUDA. Devices:
2020-01-07 20:14:24.104706: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 20:14:24.125714: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 20:14:24.127654: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x56530fb4a350 executing computations on platform Host. Devices:
2020-01-07 20:14:24.127714: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 20:14:24.128896: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 20:14:24.128950: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:14:24.128965: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 20:14:24.128977: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 20:14:24.128990: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 20:14:24.129002: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 20:14:24.129013: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 20:14:24.129026: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 20:14:24.130986: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 20:14:24.131040: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:14:24.132603: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 20:14:24.132617: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 20:14:24.132625: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 20:14:24.135076: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 20:14:24.138309 140696594089728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 20:14:25.916526: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=1, batch_size=4096, dataset='movie', dim=8, gpu_id='0', kge_interval=3, l2_weight=1e-06, lr_kge=0.01, lr_rs=0.02, n_epochs=20)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.8904  acc: 0.8076    eval auc: 0.8840  acc: 0.8038    test auc: 0.8842  acc: 0.8037, pre: 0.7950, rec: 0.8191, f1: 0.8069
precision: 0.1023	0.1078	0.0968	0.0922	0.0876	0.0762	0.0628	
recall: 0.0194	0.0494	0.0889	0.1261	0.1621	0.2114	0.2806	
f1: 0.0326	0.0678	0.0927	0.1065	0.1137	0.1120	0.1027	
ndcg: 0.1522	0.2395	0.2855	0.3109	0.3270	0.3401	0.3502	

epoch 1    train auc: 0.8981  acc: 0.8135    eval auc: 0.8860  acc: 0.8048    test auc: 0.8868  acc: 0.8057, pre: 0.7883, rec: 0.8366, f1: 0.8118
precision: 0.1110	0.1057	0.1017	0.0954	0.0876	0.0765	0.0632	
recall: 0.0205	0.0495	0.0951	0.1348	0.1651	0.2131	0.2825	
f1: 0.0346	0.0674	0.0983	0.1117	0.1145	0.1126	0.1033	
ndcg: 0.1662	0.2417	0.2933	0.3165	0.3290	0.3433	0.3539	

epoch 2    train auc: 0.9117  acc: 0.8284    eval auc: 0.8919  acc: 0.8127    test auc: 0.8933  acc: 0.8132, pre: 0.7902, rec: 0.8535, f1: 0.8206
precision: 0.1180	0.1071	0.0978	0.0908	0.0847	0.0763	0.0650	
recall: 0.0215	0.0486	0.0884	0.1260	0.1550	0.2051	0.2847	
f1: 0.0364	0.0669	0.0929	0.1056	0.1095	0.1113	0.1059	
ndcg: 0.1836	0.2558	0.3002	0.3207	0.3306	0.3445	0.3576	

epoch 3    train auc: 0.9220  acc: 0.8397    eval auc: 0.8997  acc: 0.8193    test auc: 0.9010  acc: 0.8213, pre: 0.8145, rec: 0.8326, f1: 0.8235
precision: 0.1151	0.1044	0.0983	0.0930	0.0889	0.0804	0.0684	
recall: 0.0216	0.0471	0.0875	0.1244	0.1617	0.2177	0.3018	
f1: 0.0364	0.0649	0.0926	0.1064	0.1147	0.1175	0.1116	
ndcg: 0.1747	0.2462	0.2956	0.3173	0.3324	0.3470	0.3594	

epoch 4    train auc: 0.9301  acc: 0.8510    eval auc: 0.9049  acc: 0.8280    test auc: 0.9060  acc: 0.8296, pre: 0.8077, rec: 0.8659, f1: 0.8358
precision: 0.1272	0.1224	0.1089	0.0995	0.0923	0.0821	0.0698	
recall: 0.0234	0.0577	0.1006	0.1369	0.1668	0.2212	0.3044	
f1: 0.0395	0.0784	0.1046	0.1153	0.1188	0.1197	0.1136	
ndcg: 0.1906	0.2752	0.3195	0.3392	0.3500	0.3608	0.3710	

epoch 5    train auc: 0.9361  acc: 0.8589    eval auc: 0.9078  acc: 0.8319    test auc: 0.9093  acc: 0.8331, pre: 0.8167, rec: 0.8595, f1: 0.8376
precision: 0.1423	0.1257	0.1087	0.0987	0.0928	0.0834	0.0713	
recall: 0.0259	0.0573	0.0987	0.1327	0.1661	0.2241	0.3132	
f1: 0.0438	0.0787	0.1035	0.1132	0.1191	0.1216	0.1161	
ndcg: 0.2115	0.2909	0.3308	0.3476	0.3586	0.3699	0.3797	

epoch 6    train auc: 0.9400  acc: 0.8633    eval auc: 0.9094  acc: 0.8326    test auc: 0.9109  acc: 0.8342, pre: 0.8267, rec: 0.8463, f1: 0.8364
precision: 0.1298	0.1170	0.1071	0.1013	0.0944	0.0846	0.0715	
recall: 0.0230	0.0532	0.0984	0.1396	0.1720	0.2274	0.3120	
f1: 0.0391	0.0732	0.1026	0.1174	0.1219	0.1233	0.1164	
ndcg: 0.1940	0.2704	0.3162	0.3382	0.3507	0.3632	0.3731	

epoch 7    train auc: 0.9429  acc: 0.8677    eval auc: 0.9110  acc: 0.8357    test auc: 0.9126  acc: 0.8372, pre: 0.8238, rec: 0.8584, f1: 0.8408
precision: 0.1360	0.1238	0.1098	0.1017	0.0947	0.0849	0.0721	
recall: 0.0249	0.0578	0.1003	0.1392	0.1708	0.2276	0.3140	
f1: 0.0421	0.0788	0.1049	0.1175	0.1219	0.1237	0.1173	
ndcg: 0.2074	0.2851	0.3265	0.3465	0.3574	0.3694	0.3791	

epoch 8    train auc: 0.9454  acc: 0.8708    eval auc: 0.9117  acc: 0.8364    test auc: 0.9131  acc: 0.8381, pre: 0.8250, rec: 0.8588, f1: 0.8416
precision: 0.1316	0.1204	0.1080	0.1008	0.0952	0.0856	0.0723	
recall: 0.0232	0.0558	0.0982	0.1371	0.1728	0.2292	0.3139	
f1: 0.0394	0.0762	0.1029	0.1162	0.1227	0.1246	0.1175	
ndcg: 0.1988	0.2788	0.3242	0.3442	0.3546	0.3667	0.3774	

epoch 9    train auc: 0.9470  acc: 0.8735    eval auc: 0.9119  acc: 0.8363    test auc: 0.9129  acc: 0.8389, pre: 0.8261, rec: 0.8590, f1: 0.8422
epoch 10    train auc: 0.9483  acc: 0.8745    eval auc: 0.9125  acc: 0.8373    test auc: 0.9136  acc: 0.8394, pre: 0.8240, rec: 0.8637, f1: 0.8434
precision: 0.1285	0.1200	0.1090	0.1018	0.0957	0.0862	0.0734	
recall: 0.0241	0.0559	0.0992	0.1380	0.1722	0.2296	0.3178	
f1: 0.0406	0.0763	0.1039	0.1171	0.1230	0.1254	0.1193	
ndcg: 0.1970	0.2754	0.3232	0.3446	0.3551	0.3671	0.3785	

epoch 11    train auc: 0.9497  acc: 0.8765    eval auc: 0.9126  acc: 0.8380    test auc: 0.9141  acc: 0.8405, pre: 0.8262, rec: 0.8631, f1: 0.8442
precision: 0.1319	0.1200	0.1078	0.0997	0.0937	0.0849	0.0727	
recall: 0.0237	0.0537	0.0979	0.1338	0.1680	0.2228	0.3116	
f1: 0.0402	0.0742	0.1026	0.1143	0.1203	0.1230	0.1179	
ndcg: 0.1981	0.2744	0.3223	0.3416	0.3520	0.3644	0.3755	

epoch 12    train auc: 0.9502  acc: 0.8772    eval auc: 0.9129  acc: 0.8372    test auc: 0.9144  acc: 0.8398, pre: 0.8324, rec: 0.8515, f1: 0.8418
epoch 13    train auc: 0.9513  acc: 0.8787    eval auc: 0.9133  acc: 0.8378    test auc: 0.9148  acc: 0.8407, pre: 0.8298, rec: 0.8578, f1: 0.8436
epoch 14    train auc: 0.9522  acc: 0.8801    eval auc: 0.9137  acc: 0.8390    test auc: 0.9150  acc: 0.8411, pre: 0.8304, rec: 0.8579, f1: 0.8439
precision: 0.1287	0.1172	0.1085	0.1017	0.0958	0.0858	0.0736	
recall: 0.0228	0.0514	0.0973	0.1369	0.1715	0.2255	0.3155	
f1: 0.0387	0.0715	0.1026	0.1167	0.1230	0.1244	0.1193	
ndcg: 0.1932	0.2709	0.3187	0.3402	0.3526	0.3637	0.3742	

epoch 15    train auc: 0.9525  acc: 0.8810    eval auc: 0.9132  acc: 0.8384    test auc: 0.9148  acc: 0.8414, pre: 0.8287, rec: 0.8612, f1: 0.8446
epoch 16    train auc: 0.9535  acc: 0.8820    eval auc: 0.9139  acc: 0.8389    test auc: 0.9154  acc: 0.8420, pre: 0.8253, rec: 0.8681, f1: 0.8462
epoch 17    train auc: 0.9540  acc: 0.8822    eval auc: 0.9143  acc: 0.8395    test auc: 0.9154  acc: 0.8411, pre: 0.8334, rec: 0.8531, f1: 0.8431
precision: 0.1353	0.1245	0.1114	0.1029	0.0964	0.0865	0.0739	
recall: 0.0248	0.0554	0.0990	0.1375	0.1723	0.2291	0.3171	
f1: 0.0419	0.0767	0.1048	0.1177	0.1236	0.1256	0.1199	
ndcg: 0.2052	0.2833	0.3289	0.3494	0.3602	0.3707	0.3814	

epoch 18    train auc: 0.9541  acc: 0.8827    eval auc: 0.9136  acc: 0.8400    test auc: 0.9151  acc: 0.8423, pre: 0.8293, rec: 0.8627, f1: 0.8457
precision: 0.1277	0.1146	0.1044	0.0983	0.0930	0.0840	0.0723	
recall: 0.0237	0.0509	0.0933	0.1296	0.1621	0.2176	0.3065	
f1: 0.0400	0.0705	0.0985	0.1118	0.1182	0.1212	0.1170	
ndcg: 0.1926	0.2674	0.3133	0.3353	0.3473	0.3584	0.3708	

epoch 19    train auc: 0.9548  acc: 0.8838    eval auc: 0.9139  acc: 0.8392    test auc: 0.9155  acc: 0.8426, pre: 0.8302, rec: 0.8619, f1: 0.8458
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 20:21:40.739528 140004854986496 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 20:21:40.758777 140004854986496 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 20:21:40.759465 140004854986496 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 20:21:40.795715 140004854986496 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 20:21:40.848238 140004854986496 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 20:21:40.850153 140004854986496 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 20:21:40.886981 140004854986496 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 20:21:40.908294 140004854986496 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 20:21:42.666262 140004854986496 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 20:21:42.668655: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 20:21:42.678445: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 20:21:42.678652: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:21:42.679878: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 20:21:42.681063: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 20:21:42.681369: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 20:21:42.682763: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 20:21:42.684088: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 20:21:42.688426: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 20:21:42.690569: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 20:21:42.691266: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 20:21:42.812344: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55cd1fbf93c0 executing computations on platform CUDA. Devices:
2020-01-07 20:21:42.812405: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 20:21:42.833482: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 20:21:42.835658: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55cd1fcf1220 executing computations on platform Host. Devices:
2020-01-07 20:21:42.835709: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 20:21:42.836987: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 20:21:42.837060: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:21:42.837075: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 20:21:42.837088: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 20:21:42.837100: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 20:21:42.837113: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 20:21:42.837125: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 20:21:42.837138: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 20:21:42.839004: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 20:21:42.839041: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:21:42.840429: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 20:21:42.840442: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 20:21:42.840449: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 20:21:42.842801: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 20:21:42.846044 140004854986496 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 20:21:44.654107: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=1, batch_size=4096, dataset='movie', dim=8, gpu_id='0', kge_interval=3, l2_weight=1e-06, lr_kge=0.01, lr_rs=0.02, n_epochs=20)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.8896  acc: 0.8060    eval auc: 0.8837  acc: 0.8026    test auc: 0.8843  acc: 0.8034, pre: 0.8000, rec: 0.8099, f1: 0.8049
precision: 0.1226	0.0966	0.0873	0.0814	0.0767	0.0720	0.0625	
recall: 0.0232	0.0437	0.0787	0.1117	0.1383	0.1948	0.2791	
f1: 0.0390	0.0602	0.0827	0.0942	0.0986	0.1052	0.1021	
ndcg: 0.1869	0.2456	0.2850	0.3051	0.3164	0.3329	0.3476	

epoch 1    train auc: 0.8968  acc: 0.8124    eval auc: 0.8862  acc: 0.8047    test auc: 0.8868  acc: 0.8057, pre: 0.7884, rec: 0.8363, f1: 0.8117
precision: 0.1083	0.1064	0.1000	0.0940	0.0870	0.0754	0.0629	
recall: 0.0189	0.0483	0.0948	0.1335	0.1646	0.2092	0.2817	
f1: 0.0321	0.0664	0.0973	0.1103	0.1138	0.1109	0.1029	
ndcg: 0.1585	0.2421	0.2943	0.3168	0.3287	0.3403	0.3515	

epoch 2    train auc: 0.9082  acc: 0.8236    eval auc: 0.8917  acc: 0.8117    test auc: 0.8920  acc: 0.8120, pre: 0.8015, rec: 0.8300, f1: 0.8155
precision: 0.1179	0.1082	0.0979	0.0912	0.0867	0.0778	0.0654	
recall: 0.0211	0.0509	0.0933	0.1280	0.1605	0.2135	0.2885	
f1: 0.0358	0.0692	0.0955	0.1065	0.1125	0.1141	0.1066	
ndcg: 0.1810	0.2563	0.3029	0.3230	0.3351	0.3473	0.3581	

epoch 3    train auc: 0.9214  acc: 0.8398    eval auc: 0.8994  acc: 0.8208    test auc: 0.8999  acc: 0.8213, pre: 0.8101, rec: 0.8400, f1: 0.8248
precision: 0.1313	0.1170	0.1050	0.0974	0.0904	0.0804	0.0673	
recall: 0.0250	0.0551	0.0985	0.1355	0.1667	0.2194	0.2971	
f1: 0.0420	0.0749	0.1016	0.1133	0.1172	0.1176	0.1098	
ndcg: 0.1995	0.2734	0.3173	0.3392	0.3488	0.3603	0.3704	

epoch 4    train auc: 0.9291  acc: 0.8499    eval auc: 0.9042  acc: 0.8269    test auc: 0.9058  acc: 0.8282, pre: 0.8113, rec: 0.8558, f1: 0.8330
precision: 0.1250	0.1180	0.1073	0.0994	0.0935	0.0822	0.0691	
recall: 0.0238	0.0567	0.1016	0.1391	0.1728	0.2208	0.3008	
f1: 0.0400	0.0766	0.1044	0.1159	0.1213	0.1197	0.1124	
ndcg: 0.1898	0.2710	0.3176	0.3377	0.3501	0.3609	0.3698	

epoch 5    train auc: 0.9336  acc: 0.8548    eval auc: 0.9073  acc: 0.8305    test auc: 0.9084  acc: 0.8316, pre: 0.8190, rec: 0.8520, f1: 0.8352
precision: 0.1409	0.1253	0.1091	0.0994	0.0930	0.0835	0.0702	
recall: 0.0261	0.0573	0.1001	0.1370	0.1692	0.2236	0.3057	
f1: 0.0440	0.0786	0.1044	0.1153	0.1201	0.1216	0.1141	
ndcg: 0.2108	0.2852	0.3275	0.3452	0.3553	0.3666	0.3764	

epoch 6    train auc: 0.9377  acc: 0.8605    eval auc: 0.9085  acc: 0.8327    test auc: 0.9093  acc: 0.8330, pre: 0.8227, rec: 0.8498, f1: 0.8360
precision: 0.1187	0.1125	0.1056	0.0984	0.0919	0.0822	0.0705	
recall: 0.0214	0.0520	0.0967	0.1351	0.1678	0.2206	0.3088	
f1: 0.0363	0.0711	0.1009	0.1139	0.1187	0.1198	0.1147	
ndcg: 0.1825	0.2633	0.3113	0.3328	0.3444	0.3568	0.3682	

epoch 7    train auc: 0.9397  acc: 0.8630    eval auc: 0.9099  acc: 0.8338    test auc: 0.9108  acc: 0.8345, pre: 0.8239, rec: 0.8514, f1: 0.8374
precision: 0.1383	0.1295	0.1148	0.1038	0.0965	0.0846	0.0712	
recall: 0.0259	0.0630	0.1077	0.1443	0.1762	0.2282	0.3103	
f1: 0.0437	0.0848	0.1111	0.1208	0.1247	0.1234	0.1158	
ndcg: 0.2113	0.2936	0.3358	0.3538	0.3643	0.3732	0.3826	

epoch 8    train auc: 0.9414  acc: 0.8656    eval auc: 0.9108  acc: 0.8353    test auc: 0.9118  acc: 0.8363, pre: 0.8226, rec: 0.8583, f1: 0.8400
precision: 0.1410	0.1244	0.1099	0.1011	0.0946	0.0846	0.0717	
recall: 0.0279	0.0605	0.1039	0.1414	0.1734	0.2269	0.3118	
f1: 0.0465	0.0815	0.1068	0.1179	0.1224	0.1233	0.1166	
ndcg: 0.2135	0.2918	0.3341	0.3517	0.3626	0.3735	0.3829	

epoch 9    train auc: 0.9420  acc: 0.8661    eval auc: 0.9113  acc: 0.8351    test auc: 0.9120  acc: 0.8358, pre: 0.8289, rec: 0.8469, f1: 0.8378
epoch 10    train auc: 0.9439  acc: 0.8686    eval auc: 0.9119  acc: 0.8363    test auc: 0.9128  acc: 0.8371, pre: 0.8242, rec: 0.8577, f1: 0.8406
precision: 0.1389	0.1242	0.1125	0.1026	0.0956	0.0851	0.0722	
recall: 0.0262	0.0576	0.1033	0.1391	0.1707	0.2257	0.3128	
f1: 0.0440	0.0787	0.1077	0.1181	0.1225	0.1236	0.1173	
ndcg: 0.2089	0.2869	0.3327	0.3497	0.3598	0.3708	0.3805	

epoch 11    train auc: 0.9447  acc: 0.8696    eval auc: 0.9121  acc: 0.8372    test auc: 0.9131  acc: 0.8378, pre: 0.8192, rec: 0.8675, f1: 0.8427
precision: 0.1306	0.1187	0.1097	0.1022	0.0963	0.0857	0.0726	
recall: 0.0251	0.0561	0.1024	0.1401	0.1735	0.2280	0.3156	
f1: 0.0422	0.0762	0.1059	0.1182	0.1239	0.1246	0.1181	
ndcg: 0.1968	0.2773	0.3261	0.3445	0.3557	0.3670	0.3781	

epoch 12    train auc: 0.9456  acc: 0.8705    eval auc: 0.9117  acc: 0.8358    test auc: 0.9126  acc: 0.8366, pre: 0.8306, rec: 0.8461, f1: 0.8383
epoch 13    train auc: 0.9458  acc: 0.8714    eval auc: 0.9130  acc: 0.8380    test auc: 0.9139  acc: 0.8386, pre: 0.8236, rec: 0.8623, f1: 0.8425
precision: 0.1383	0.1236	0.1108	0.1026	0.0953	0.0853	0.0727	
recall: 0.0263	0.0591	0.1041	0.1429	0.1730	0.2271	0.3167	
f1: 0.0442	0.0800	0.1073	0.1195	0.1229	0.1241	0.1183	
ndcg: 0.2088	0.2880	0.3314	0.3495	0.3594	0.3701	0.3809	

epoch 14    train auc: 0.9465  acc: 0.8720    eval auc: 0.9133  acc: 0.8378    test auc: 0.9143  acc: 0.8394, pre: 0.8245, rec: 0.8628, f1: 0.8432
epoch 15    train auc: 0.9470  acc: 0.8721    eval auc: 0.9135  acc: 0.8371    test auc: 0.9144  acc: 0.8381, pre: 0.8347, rec: 0.8438, f1: 0.8392
epoch 16    train auc: 0.9478  acc: 0.8736    eval auc: 0.9136  acc: 0.8383    test auc: 0.9143  acc: 0.8392, pre: 0.8267, rec: 0.8590, f1: 0.8425
precision: 0.1507	0.1348	0.1183	0.1063	0.0986	0.0873	0.0737	
recall: 0.0291	0.0648	0.1095	0.1462	0.1789	0.2331	0.3200	
f1: 0.0487	0.0875	0.1137	0.1231	0.1271	0.1270	0.1198	
ndcg: 0.2241	0.3043	0.3465	0.3626	0.3716	0.3807	0.3900	

epoch 17    train auc: 0.9480  acc: 0.8739    eval auc: 0.9138  acc: 0.8388    test auc: 0.9146  acc: 0.8396, pre: 0.8250, rec: 0.8626, f1: 0.8434
precision: 0.1367	0.1264	0.1136	0.1039	0.0962	0.0865	0.0731	
recall: 0.0260	0.0583	0.1051	0.1418	0.1737	0.2288	0.3147	
f1: 0.0437	0.0798	0.1092	0.1199	0.1238	0.1255	0.1186	
ndcg: 0.2063	0.2889	0.3347	0.3522	0.3615	0.3714	0.3811	

epoch 18    train auc: 0.9480  acc: 0.8731    eval auc: 0.9139  acc: 0.8389    test auc: 0.9147  acc: 0.8394, pre: 0.8327, rec: 0.8501, f1: 0.8413
precision: 0.1440	0.1285	0.1119	0.1031	0.0969	0.0867	0.0737	
recall: 0.0278	0.0614	0.1046	0.1416	0.1748	0.2294	0.3172	
f1: 0.0467	0.0831	0.1081	0.1193	0.1247	0.1258	0.1196	
ndcg: 0.2162	0.2940	0.3376	0.3534	0.3636	0.3741	0.3848	

epoch 19    train auc: 0.9489  acc: 0.8751    eval auc: 0.9138  acc: 0.8394    test auc: 0.9148  acc: 0.8397, pre: 0.8198, rec: 0.8713, f1: 0.8448
precision: 0.1468	0.1308	0.1153	0.1051	0.0970	0.0866	0.0736	
recall: 0.0278	0.0609	0.1063	0.1430	0.1740	0.2297	0.3161	
f1: 0.0467	0.0831	0.1106	0.1212	0.1246	0.1258	0.1194	
ndcg: 0.2176	0.2968	0.3402	0.3566	0.3663	0.3754	0.3842	

/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 20:29:44.949337 139765640398592 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 20:29:44.968412 139765640398592 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 20:29:44.969111 139765640398592 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 20:29:45.005053 139765640398592 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 20:29:45.055715 139765640398592 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 20:29:45.057578 139765640398592 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 20:29:45.093190 139765640398592 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 20:29:45.114014 139765640398592 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 20:29:46.860227 139765640398592 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 20:29:46.862318: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 20:29:46.871226: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 20:29:46.871403: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:29:46.872374: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 20:29:46.873447: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 20:29:46.873718: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 20:29:46.874934: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 20:29:46.876054: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 20:29:46.879779: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 20:29:46.881627: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 20:29:46.882256: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 20:29:46.998499: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55b6214e26b0 executing computations on platform CUDA. Devices:
2020-01-07 20:29:46.998600: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 20:29:47.021515: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 20:29:47.023545: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55b6215da580 executing computations on platform Host. Devices:
2020-01-07 20:29:47.023600: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 20:29:47.024805: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 20:29:47.024864: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:29:47.024878: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 20:29:47.024890: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 20:29:47.024902: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 20:29:47.024914: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 20:29:47.024926: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 20:29:47.024949: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 20:29:47.027111: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 20:29:47.027176: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 20:29:47.028893: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 20:29:47.028916: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 20:29:47.028924: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 20:29:47.031586: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 20:29:47.034766 139765640398592 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 20:29:48.787394: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=1, batch_size=4096, dataset='movie', dim=8, gpu_id='0', kge_interval=3, l2_weight=1e-06, lr_kge=0.01, lr_rs=0.02, n_epochs=20)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.8900  acc: 0.8050    eval auc: 0.8836  acc: 0.8028    test auc: 0.8838  acc: 0.8022, pre: 0.8022, rec: 0.8030, f1: 0.8026
precision: 0.1191	0.1031	0.0957	0.0909	0.0865	0.0763	0.0632	
recall: 0.0218	0.0476	0.0869	0.1268	0.1629	0.2133	0.2834	
f1: 0.0369	0.0651	0.0911	0.1059	0.1130	0.1124	0.1033	
ndcg: 0.1844	0.2510	0.2964	0.3194	0.3342	0.3448	0.3552	

epoch 1    train auc: 0.9012  acc: 0.8155    eval auc: 0.8883  acc: 0.8075    test auc: 0.8889  acc: 0.8076, pre: 0.7950, rec: 0.8298, f1: 0.8120
precision: 0.1193	0.1172	0.1025	0.0950	0.0885	0.0773	0.0639	
recall: 0.0222	0.0570	0.0975	0.1337	0.1638	0.2114	0.2841	
f1: 0.0374	0.0767	0.0999	0.1110	0.1149	0.1132	0.1044	
ndcg: 0.1752	0.2642	0.3071	0.3285	0.3387	0.3494	0.3596	

epoch 2    train auc: 0.9178  acc: 0.8355    eval auc: 0.8989  acc: 0.8203    test auc: 0.8999  acc: 0.8206, pre: 0.8070, rec: 0.8435, f1: 0.8249
precision: 0.1202	0.1150	0.1063	0.0968	0.0889	0.0789	0.0670	
recall: 0.0241	0.0565	0.1017	0.1357	0.1657	0.2144	0.2941	
f1: 0.0402	0.0758	0.1040	0.1130	0.1157	0.1154	0.1092	
ndcg: 0.1806	0.2631	0.3137	0.3333	0.3443	0.3551	0.3650	

epoch 3    train auc: 0.9288  acc: 0.8485    eval auc: 0.9043  acc: 0.8257    test auc: 0.9056  acc: 0.8272, pre: 0.8223, rec: 0.8354, f1: 0.8288
precision: 0.1408	0.1230	0.1070	0.0972	0.0906	0.0812	0.0689	
recall: 0.0268	0.0575	0.0998	0.1363	0.1668	0.2207	0.3029	
f1: 0.0451	0.0784	0.1033	0.1135	0.1174	0.1187	0.1123	
ndcg: 0.2100	0.2854	0.3256	0.3437	0.3544	0.3655	0.3753	

epoch 4    train auc: 0.9352  acc: 0.8572    eval auc: 0.9081  acc: 0.8316    test auc: 0.9091  acc: 0.8322, pre: 0.8233, rec: 0.8466, f1: 0.8348
precision: 0.1321	0.1228	0.1075	0.0987	0.0927	0.0833	0.0705	
recall: 0.0249	0.0589	0.1008	0.1369	0.1708	0.2263	0.3109	
f1: 0.0419	0.0796	0.1041	0.1147	0.1202	0.1218	0.1150	
ndcg: 0.2015	0.2797	0.3231	0.3410	0.3537	0.3653	0.3763	

epoch 5    train auc: 0.9392  acc: 0.8626    eval auc: 0.9101  acc: 0.8345    test auc: 0.9111  acc: 0.8352, pre: 0.8169, rec: 0.8646, f1: 0.8401
precision: 0.1343	0.1223	0.1100	0.1010	0.0949	0.0850	0.0718	
recall: 0.0260	0.0592	0.1038	0.1405	0.1720	0.2298	0.3139	
f1: 0.0436	0.0798	0.1068	0.1175	0.1223	0.1241	0.1169	
ndcg: 0.2065	0.2836	0.3288	0.3478	0.3573	0.3703	0.3795	

epoch 6    train auc: 0.9419  acc: 0.8663    eval auc: 0.9106  acc: 0.8349    test auc: 0.9111  acc: 0.8353, pre: 0.8241, rec: 0.8532, f1: 0.8384
precision: 0.1366	0.1269	0.1114	0.1011	0.0946	0.0843	0.0715	
recall: 0.0257	0.0603	0.1051	0.1420	0.1744	0.2286	0.3128	
f1: 0.0432	0.0818	0.1082	0.1181	0.1227	0.1232	0.1164	
ndcg: 0.2064	0.2894	0.3317	0.3492	0.3596	0.3706	0.3795	

epoch 7    train auc: 0.9445  acc: 0.8699    eval auc: 0.9116  acc: 0.8362    test auc: 0.9124  acc: 0.8370, pre: 0.8182, rec: 0.8671, f1: 0.8419
precision: 0.1411	0.1287	0.1127	0.1031	0.0962	0.0852	0.0722	
recall: 0.0272	0.0611	0.1044	0.1418	0.1766	0.2316	0.3164	
f1: 0.0456	0.0829	0.1084	0.1194	0.1246	0.1246	0.1175	
ndcg: 0.2102	0.2896	0.3325	0.3511	0.3617	0.3732	0.3824	

epoch 8    train auc: 0.9465  acc: 0.8727    eval auc: 0.9124  acc: 0.8377    test auc: 0.9131  acc: 0.8380, pre: 0.8206, rec: 0.8658, f1: 0.8425
precision: 0.1287	0.1210	0.1091	0.0999	0.0928	0.0831	0.0716	
recall: 0.0253	0.0582	0.1035	0.1388	0.1685	0.2204	0.3101	
f1: 0.0422	0.0786	0.1062	0.1162	0.1197	0.1207	0.1164	
ndcg: 0.1942	0.2762	0.3235	0.3420	0.3512	0.3636	0.3759	

epoch 9    train auc: 0.9476  acc: 0.8739    eval auc: 0.9126  acc: 0.8369    test auc: 0.9134  acc: 0.8376, pre: 0.8300, rec: 0.8499, f1: 0.8398
epoch 10    train auc: 0.9492  acc: 0.8761    eval auc: 0.9138  acc: 0.8395    test auc: 0.9146  acc: 0.8394, pre: 0.8245, rec: 0.8628, f1: 0.8432
precision: 0.1449	0.1296	0.1147	0.1050	0.0975	0.0867	0.0732	
recall: 0.0283	0.0619	0.1077	0.1447	0.1776	0.2313	0.3169	
f1: 0.0474	0.0837	0.1111	0.1217	0.1259	0.1262	0.1189	
ndcg: 0.2150	0.2946	0.3369	0.3544	0.3642	0.3754	0.3847	

epoch 11    train auc: 0.9503  acc: 0.8776    eval auc: 0.9144  acc: 0.8395    test auc: 0.9151  acc: 0.8401, pre: 0.8274, rec: 0.8601, f1: 0.8435
precision: 0.1374	0.1264	0.1123	0.1028	0.0959	0.0859	0.0732	
recall: 0.0261	0.0601	0.1027	0.1407	0.1735	0.2299	0.3163	
f1: 0.0439	0.0815	0.1073	0.1188	0.1235	0.1251	0.1188	
ndcg: 0.2083	0.2870	0.3299	0.3498	0.3590	0.3707	0.3813	

epoch 12    train auc: 0.9511  acc: 0.8788    eval auc: 0.9137  acc: 0.8389    test auc: 0.9141  acc: 0.8388, pre: 0.8280, rec: 0.8560, f1: 0.8418
epoch 13    train auc: 0.9520  acc: 0.8802    eval auc: 0.9150  acc: 0.8414    test auc: 0.9157  acc: 0.8409, pre: 0.8249, rec: 0.8660, f1: 0.8450
precision: 0.1384	0.1293	0.1149	0.1039	0.0967	0.0867	0.0738	
recall: 0.0257	0.0605	0.1059	0.1413	0.1741	0.2299	0.3185	
f1: 0.0434	0.0824	0.1102	0.1197	0.1244	0.1260	0.1199	
ndcg: 0.2058	0.2907	0.3346	0.3525	0.3622	0.3736	0.3838	

epoch 14    train auc: 0.9532  acc: 0.8818    eval auc: 0.9149  acc: 0.8413    test auc: 0.9159  acc: 0.8408, pre: 0.8298, rec: 0.8582, f1: 0.8437
epoch 15    train auc: 0.9537  acc: 0.8826    eval auc: 0.9148  acc: 0.8406    test auc: 0.9153  acc: 0.8405, pre: 0.8305, rec: 0.8563, f1: 0.8432
epoch 16    train auc: 0.9541  acc: 0.8830    eval auc: 0.9151  acc: 0.8409    test auc: 0.9156  acc: 0.8406, pre: 0.8280, rec: 0.8604, f1: 0.8439
epoch 17    train auc: 0.9543  acc: 0.8831    eval auc: 0.9153  acc: 0.8415    test auc: 0.9158  acc: 0.8420, pre: 0.8244, rec: 0.8697, f1: 0.8465
precision: 0.1254	0.1162	0.1056	0.0986	0.0935	0.0848	0.0732	
recall: 0.0220	0.0516	0.0937	0.1312	0.1662	0.2243	0.3138	
f1: 0.0375	0.0715	0.0993	0.1126	0.1197	0.1230	0.1187	
ndcg: 0.1917	0.2684	0.3133	0.3343	0.3466	0.3604	0.3719	

epoch 18    train auc: 0.9551  acc: 0.8843    eval auc: 0.9153  acc: 0.8417    test auc: 0.9157  acc: 0.8411, pre: 0.8240, rec: 0.8681, f1: 0.8455
precision: 0.1360	0.1261	0.1123	0.1033	0.0966	0.0866	0.0737	
recall: 0.0250	0.0573	0.1013	0.1393	0.1720	0.2296	0.3174	
f1: 0.0422	0.0788	0.1065	0.1186	0.1237	0.1258	0.1196	
ndcg: 0.2027	0.2823	0.3263	0.3460	0.3560	0.3682	0.3789	

epoch 19    train auc: 0.9554  acc: 0.8845    eval auc: 0.9156  acc: 0.8418    test auc: 0.9160  acc: 0.8415, pre: 0.8276, rec: 0.8634, f1: 0.8451
precision: 0.1251	0.1182	0.1073	0.0995	0.0937	0.0848	0.0729	
recall: 0.0227	0.0554	0.0985	0.1345	0.1672	0.2229	0.3132	
f1: 0.0385	0.0755	0.1027	0.1144	0.1201	0.1229	0.1182	
ndcg: 0.1888	0.2715	0.3164	0.3362	0.3471	0.3606	0.3730	

