auc=0.8023555555555555; acc=0.7589777777777778
pr:	0.028166666666666666 0.026033333333333332 0.02201111111111111 0.019722222222222224 0.01818888888888889 0.015344444444444445 0.012222222222222223
re:	0.022433333333333333 0.05275555555555556 0.09032222222222223 0.12221111111111112 0.15102222222222222 0.19094444444444444 0.2502555555555556
f1:	0.024955555555555554 0.034855555555555556 0.03537777777777777 0.03398888888888889 0.032466666666666665 0.028422222222222224 0.023277777777777776
ndcg:	0.0452 0.07413333333333334 0.09764444444444445 0.11221111111111111 0.12314444444444445 0.13515555555555556 0.1504888888888889


/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 18:43:03.632453 139628990818048 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 18:43:03.651293 139628990818048 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 18:43:03.651964 139628990818048 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 18:43:03.685522 139628990818048 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 18:43:03.734061 139628990818048 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 18:43:03.735828 139628990818048 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 18:43:03.832434 139628990818048 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 18:43:03.860741 139628990818048 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 18:43:04.861162 139628990818048 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 18:43:04.862367: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 18:43:04.873664: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:43:04.873844: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:43:04.875011: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:43:04.876248: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:43:04.876535: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:43:04.877975: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:43:04.879140: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:43:04.882889: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:43:04.884895: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:43:04.885258: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 18:43:05.020120: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5652af4b7570 executing computations on platform CUDA. Devices:
2020-01-07 18:43:05.020192: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 18:43:05.041541: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 18:43:05.043705: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5652af5af3c0 executing computations on platform Host. Devices:
2020-01-07 18:43:05.043733: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 18:43:05.045008: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:43:05.045054: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:43:05.045066: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:43:05.045076: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:43:05.045086: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:43:05.045095: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:43:05.045105: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:43:05.045116: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:43:05.046841: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:43:05.046872: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:43:05.048236: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 18:43:05.048249: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 18:43:05.048256: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 18:43:05.050438: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 18:43:05.052984 139628990818048 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 18:43:06.494416: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=2, batch_size=256, dataset='music', dim=4, gpu_id='0', kge_interval=2, l2_weight=1e-06, lr_kge=0.0002, lr_rs=0.001, n_epochs=10)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.5197  acc: 0.5058    eval auc: 0.4777  acc: 0.4880    test auc: 0.4779  acc: 0.4945, pre: 0.4729, rec: 0.1304, f1: 0.2044
precision: 0.0279	0.0237	0.0171	0.0141	0.0125	0.0098	0.0070	
recall: 0.0222	0.0472	0.0695	0.0849	0.0988	0.1164	0.1418	
f1: 0.0247	0.0316	0.0275	0.0241	0.0221	0.0180	0.0134	
ndcg: 0.0480	0.0732	0.0875	0.0952	0.1002	0.1065	0.1152	

epoch 1    train auc: 0.7737  acc: 0.4998    eval auc: 0.7512  acc: 0.5024    test auc: 0.7592  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
precision: 0.0342	0.0314	0.0274	0.0266	0.0230	0.0183	0.0143	
recall: 0.0290	0.0637	0.1117	0.1644	0.1908	0.2274	0.2962	
f1: 0.0314	0.0421	0.0441	0.0458	0.0411	0.0339	0.0273	
ndcg: 0.0566	0.0905	0.1170	0.1391	0.1471	0.1579	0.1744	

epoch 2    train auc: 0.8679  acc: 0.7200    eval auc: 0.7867  acc: 0.7081    test auc: 0.7952  acc: 0.7271, pre: 0.9188, rec: 0.4960, f1: 0.6442
precision: 0.0309	0.0318	0.0289	0.0272	0.0235	0.0185	0.0148	
recall: 0.0231	0.0642	0.1230	0.1673	0.1947	0.2299	0.3027	
f1: 0.0264	0.0425	0.0469	0.0467	0.0419	0.0342	0.0281	
ndcg: 0.0519	0.0878	0.1210	0.1395	0.1469	0.1574	0.1750	

epoch 3    train auc: 0.8862  acc: 0.7621    eval auc: 0.7922  acc: 0.7373    test auc: 0.8002  acc: 0.7581, pre: 0.8801, rec: 0.5953, f1: 0.7102
precision: 0.0333	0.0307	0.0281	0.0246	0.0227	0.0180	0.0141	
recall: 0.0261	0.0630	0.1173	0.1563	0.1898	0.2234	0.2886	
f1: 0.0293	0.0413	0.0453	0.0425	0.0406	0.0334	0.0269	
ndcg: 0.0506	0.0833	0.1149	0.1313	0.1431	0.1524	0.1675	

epoch 4    train auc: 0.8949  acc: 0.7749    eval auc: 0.7933  acc: 0.7428    test auc: 0.8025  acc: 0.7607, pre: 0.8581, rec: 0.6223, f1: 0.7215
precision: 0.0333	0.0300	0.0252	0.0226	0.0193	0.0168	0.0135	
recall: 0.0261	0.0597	0.1035	0.1411	0.1601	0.2097	0.2766	
f1: 0.0293	0.0399	0.0405	0.0390	0.0345	0.0311	0.0257	
ndcg: 0.0506	0.0818	0.1083	0.1245	0.1317	0.1461	0.1606	

epoch 5    train auc: 0.9006  acc: 0.7902    eval auc: 0.7942  acc: 0.7437    test auc: 0.8044  acc: 0.7579, pre: 0.8170, rec: 0.6624, f1: 0.7316
precision: 0.0336	0.0290	0.0241	0.0197	0.0186	0.0155	0.0130	
recall: 0.0263	0.0583	0.0985	0.1226	0.1558	0.1950	0.2678	
f1: 0.0295	0.0387	0.0387	0.0340	0.0333	0.0288	0.0247	
ndcg: 0.0506	0.0802	0.1048	0.1150	0.1274	0.1378	0.1577	

epoch 6    train auc: 0.9044  acc: 0.7963    eval auc: 0.7943  acc: 0.7400    test auc: 0.8051  acc: 0.7477, pre: 0.7848, rec: 0.6797, f1: 0.7285
epoch 7    train auc: 0.9078  acc: 0.8020    eval auc: 0.7940  acc: 0.7318    test auc: 0.8044  acc: 0.7363, pre: 0.7548, rec: 0.6970, f1: 0.7248
epoch 8    train auc: 0.9114  acc: 0.8067    eval auc: 0.7931  acc: 0.7265    test auc: 0.8035  acc: 0.7303, pre: 0.7351, rec: 0.7169, f1: 0.7259
epoch 9    train auc: 0.9149  acc: 0.8091    eval auc: 0.7914  acc: 0.7236    test auc: 0.8015  acc: 0.7287, pre: 0.7304, rec: 0.7214, f1: 0.7259
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 18:44:24.888388 139877082048256 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 18:44:24.907877 139877082048256 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 18:44:24.908524 139877082048256 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 18:44:24.941756 139877082048256 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 18:44:24.989933 139877082048256 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 18:44:24.991717 139877082048256 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 18:44:25.087730 139877082048256 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 18:44:25.115942 139877082048256 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 18:44:26.102530 139877082048256 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 18:44:26.103774: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 18:44:26.113597: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:44:26.113798: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:44:26.115174: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:44:26.116453: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:44:26.116734: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:44:26.118213: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:44:26.119372: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:44:26.123201: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:44:26.125104: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:44:26.125512: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 18:44:26.242283: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55bfae329160 executing computations on platform CUDA. Devices:
2020-01-07 18:44:26.242344: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 18:44:26.265707: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 18:44:26.267718: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55bfae420fe0 executing computations on platform Host. Devices:
2020-01-07 18:44:26.267745: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 18:44:26.269015: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:44:26.269069: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:44:26.269084: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:44:26.269096: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:44:26.269109: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:44:26.269121: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:44:26.269133: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:44:26.269146: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:44:26.270965: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:44:26.270999: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:44:26.272411: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 18:44:26.272432: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 18:44:26.272439: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 18:44:26.274706: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 18:44:26.277454 139877082048256 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 18:44:27.776336: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=2, batch_size=256, dataset='music', dim=4, gpu_id='0', kge_interval=2, l2_weight=1e-06, lr_kge=0.0002, lr_rs=0.001, n_epochs=10)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.4962  acc: 0.4930    eval auc: 0.5088  acc: 0.5099    test auc: 0.5028  acc: 0.5113, pre: 0.5049, rec: 0.9561, f1: 0.6609
precision: 0.0006	0.0010	0.0011	0.0012	0.0013	0.0018	0.0037	
recall: 0.0005	0.0013	0.0040	0.0065	0.0086	0.0195	0.0699	
f1: 0.0005	0.0011	0.0017	0.0021	0.0022	0.0034	0.0069	
ndcg: 0.0010	0.0025	0.0041	0.0055	0.0068	0.0128	0.0343	

epoch 1    train auc: 0.4939  acc: 0.4934    eval auc: 0.5038  acc: 0.5061    test auc: 0.5146  acc: 0.5138, pre: 0.5065, rec: 0.9239, f1: 0.6543
epoch 2    train auc: 0.5094  acc: 0.4998    eval auc: 0.4971  acc: 0.5024    test auc: 0.4752  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 3    train auc: 0.5334  acc: 0.4998    eval auc: 0.4649  acc: 0.5024    test auc: 0.4508  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 4    train auc: 0.8063  acc: 0.6612    eval auc: 0.7736  acc: 0.6560    test auc: 0.7902  acc: 0.6709, pre: 0.9398, rec: 0.3625, f1: 0.5232
precision: 0.0300	0.0349	0.0304	0.0268	0.0234	0.0188	0.0142	
recall: 0.0233	0.0742	0.1292	0.1673	0.1950	0.2339	0.2885	
f1: 0.0262	0.0474	0.0493	0.0461	0.0418	0.0349	0.0270	
ndcg: 0.0485	0.0921	0.1235	0.1387	0.1484	0.1594	0.1732	

epoch 5    train auc: 0.8687  acc: 0.7594    eval auc: 0.7922  acc: 0.7342    test auc: 0.8030  acc: 0.7563, pre: 0.8814, rec: 0.5901, f1: 0.7069
precision: 0.0273	0.0319	0.0288	0.0251	0.0229	0.0182	0.0138	
recall: 0.0215	0.0631	0.1224	0.1575	0.1884	0.2249	0.2825	
f1: 0.0240	0.0424	0.0467	0.0433	0.0408	0.0337	0.0263	
ndcg: 0.0467	0.0857	0.1201	0.1354	0.1449	0.1564	0.1706	

epoch 6    train auc: 0.8827  acc: 0.7622    eval auc: 0.7961  acc: 0.7368    test auc: 0.8060  acc: 0.7590, pre: 0.8799, rec: 0.5977, f1: 0.7118
precision: 0.0285	0.0315	0.0278	0.0241	0.0205	0.0168	0.0130	
recall: 0.0219	0.0627	0.1177	0.1514	0.1710	0.2082	0.2665	
f1: 0.0248	0.0420	0.0450	0.0416	0.0366	0.0311	0.0248	
ndcg: 0.0481	0.0870	0.1185	0.1331	0.1401	0.1509	0.1657	

epoch 7    train auc: 0.8933  acc: 0.7815    eval auc: 0.7938  acc: 0.7494    test auc: 0.8044  acc: 0.7638, pre: 0.8361, rec: 0.6541, f1: 0.7340
precision: 0.0279	0.0310	0.0237	0.0216	0.0194	0.0161	0.0126	
recall: 0.0221	0.0622	0.0978	0.1353	0.1620	0.2004	0.2555	
f1: 0.0247	0.0414	0.0381	0.0373	0.0346	0.0298	0.0240	
ndcg: 0.0474	0.0850	0.1067	0.1240	0.1330	0.1442	0.1584	

epoch 8    train auc: 0.8998  acc: 0.7786    eval auc: 0.7969  acc: 0.7442    test auc: 0.8095  acc: 0.7603, pre: 0.8412, rec: 0.6394, f1: 0.7266
epoch 9    train auc: 0.9076  acc: 0.7990    eval auc: 0.7947  acc: 0.7390    test auc: 0.8062  acc: 0.7460, pre: 0.7703, rec: 0.6982, f1: 0.7325
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 18:45:33.937859 139891302774528 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 18:45:33.955238 139891302774528 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 18:45:33.955864 139891302774528 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 18:45:33.989057 139891302774528 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 18:45:34.037309 139891302774528 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 18:45:34.039060 139891302774528 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 18:45:34.134838 139891302774528 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 18:45:34.162966 139891302774528 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 18:45:35.145008 139891302774528 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 18:45:35.146252: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 18:45:35.166425: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:45:35.166611: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:45:35.167771: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:45:35.168982: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:45:35.169249: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:45:35.170739: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:45:35.171886: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:45:35.175735: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:45:35.231003: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:45:35.231360: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 18:45:35.333458: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5624d19acc10 executing computations on platform CUDA. Devices:
2020-01-07 18:45:35.333508: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 18:45:35.353633: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 18:45:35.355824: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5624d1aa4a80 executing computations on platform Host. Devices:
2020-01-07 18:45:35.355857: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 18:45:35.357127: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:45:35.357171: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:45:35.357182: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:45:35.357192: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:45:35.357201: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:45:35.357211: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:45:35.357220: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:45:35.357230: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:45:35.359197: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:45:35.359227: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:45:35.360590: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 18:45:35.360601: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 18:45:35.360607: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 18:45:35.362786: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 18:45:35.365342 139891302774528 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 18:45:36.768729: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=2, batch_size=256, dataset='music', dim=4, gpu_id='0', kge_interval=2, l2_weight=1e-06, lr_kge=0.0002, lr_rs=0.001, n_epochs=10)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.4940  acc: 0.4958    eval auc: 0.5160  acc: 0.5024    test auc: 0.5079  acc: 0.5101, pre: 0.5321, rec: 0.1356, f1: 0.2161
precision: 0.0240	0.0232	0.0185	0.0154	0.0132	0.0103	0.0074	
recall: 0.0205	0.0500	0.0786	0.0971	0.1075	0.1242	0.1466	
f1: 0.0221	0.0317	0.0300	0.0266	0.0234	0.0191	0.0142	
ndcg: 0.0411	0.0686	0.0858	0.0944	0.0997	0.1069	0.1156	

epoch 1    train auc: 0.6706  acc: 0.4998    eval auc: 0.6567  acc: 0.5024    test auc: 0.6776  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 2    train auc: 0.8649  acc: 0.7016    eval auc: 0.7891  acc: 0.6911    test auc: 0.8015  acc: 0.7113, pre: 0.9289, rec: 0.4552, f1: 0.6110
precision: 0.0279	0.0288	0.0298	0.0260	0.0231	0.0190	0.0144	
recall: 0.0219	0.0620	0.1261	0.1617	0.1902	0.2356	0.2993	
f1: 0.0245	0.0393	0.0482	0.0447	0.0411	0.0351	0.0276	
ndcg: 0.0440	0.0782	0.1181	0.1328	0.1428	0.1542	0.1686	

epoch 3    train auc: 0.8842  acc: 0.7641    eval auc: 0.7940  acc: 0.7395    test auc: 0.8031  acc: 0.7582, pre: 0.8757, rec: 0.5996, f1: 0.7118
precision: 0.0258	0.0279	0.0277	0.0250	0.0227	0.0181	0.0140	
recall: 0.0203	0.0578	0.1181	0.1557	0.1849	0.2238	0.2888	
f1: 0.0227	0.0376	0.0449	0.0431	0.0404	0.0336	0.0267	
ndcg: 0.0442	0.0789	0.1144	0.1326	0.1434	0.1540	0.1669	

epoch 4    train auc: 0.8941  acc: 0.7671    eval auc: 0.7946  acc: 0.7401    test auc: 0.8065  acc: 0.7568, pre: 0.8663, rec: 0.6050, f1: 0.7125
precision: 0.0258	0.0278	0.0237	0.0227	0.0197	0.0168	0.0133	
recall: 0.0203	0.0561	0.0959	0.1413	0.1627	0.2065	0.2759	
f1: 0.0227	0.0372	0.0380	0.0391	0.0352	0.0310	0.0254	
ndcg: 0.0411	0.0753	0.1009	0.1215	0.1297	0.1437	0.1581	

epoch 5    train auc: 0.8999  acc: 0.7814    eval auc: 0.7965  acc: 0.7463    test auc: 0.8079  acc: 0.7649, pre: 0.8408, rec: 0.6513, f1: 0.7340
precision: 0.0258	0.0261	0.0220	0.0196	0.0183	0.0157	0.0126	
recall: 0.0203	0.0535	0.0873	0.1228	0.1519	0.1944	0.2569	
f1: 0.0227	0.0351	0.0352	0.0338	0.0327	0.0291	0.0239	
ndcg: 0.0411	0.0736	0.0964	0.1106	0.1222	0.1359	0.1510	

epoch 6    train auc: 0.9024  acc: 0.7807    eval auc: 0.7968  acc: 0.7445    test auc: 0.8090  acc: 0.7605, pre: 0.8378, rec: 0.6439, f1: 0.7282
epoch 7    train auc: 0.9049  acc: 0.7899    eval auc: 0.7958  acc: 0.7494    test auc: 0.8073  acc: 0.7602, pre: 0.8083, rec: 0.6797, f1: 0.7384
precision: 0.0261	0.0189	0.0165	0.0169	0.0162	0.0134	0.0108	
recall: 0.0204	0.0390	0.0674	0.1029	0.1360	0.1670	0.2210	
f1: 0.0229	0.0255	0.0265	0.0291	0.0290	0.0248	0.0205	
ndcg: 0.0408	0.0599	0.0767	0.0948	0.1083	0.1192	0.1329	

epoch 8    train auc: 0.9060  acc: 0.7898    eval auc: 0.7955  acc: 0.7471    test auc: 0.8074  acc: 0.7583, pre: 0.8081, rec: 0.6750, f1: 0.7356
epoch 9    train auc: 0.9077  acc: 0.7920    eval auc: 0.7940  acc: 0.7435    test auc: 0.8057  acc: 0.7455, pre: 0.7637, rec: 0.7082, f1: 0.7349
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 18:46:55.190114 140190870583040 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 18:46:55.207665 140190870583040 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 18:46:55.208303 140190870583040 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 18:46:55.241780 140190870583040 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 18:46:55.290076 140190870583040 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 18:46:55.291843 140190870583040 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 18:46:55.388463 140190870583040 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 18:46:55.416974 140190870583040 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 18:46:56.405761 140190870583040 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 18:46:56.406996: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 18:46:56.416946: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:46:56.417137: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:46:56.418365: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:46:56.419600: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:46:56.419886: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:46:56.421325: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:46:56.422477: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:46:56.426249: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:46:56.428093: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:46:56.428424: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 18:46:56.549964: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5622a6089e00 executing computations on platform CUDA. Devices:
2020-01-07 18:46:56.550065: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 18:46:56.569624: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 18:46:56.571771: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5622a6181c60 executing computations on platform Host. Devices:
2020-01-07 18:46:56.571802: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 18:46:56.573083: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:46:56.573131: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:46:56.573145: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:46:56.573157: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:46:56.573169: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:46:56.573181: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:46:56.573192: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:46:56.573204: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:46:56.575144: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:46:56.575176: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:46:56.576687: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 18:46:56.576700: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 18:46:56.576707: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 18:46:56.579039: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 18:46:56.581794 140190870583040 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 18:46:58.041005: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=2, batch_size=256, dataset='music', dim=4, gpu_id='0', kge_interval=2, l2_weight=1e-06, lr_kge=0.0002, lr_rs=0.001, n_epochs=10)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.4875  acc: 0.4912    eval auc: 0.5171  acc: 0.5148    test auc: 0.5201  acc: 0.5114, pre: 0.5070, rec: 0.6844, f1: 0.5825
precision: 0.0027	0.0025	0.0020	0.0023	0.0022	0.0024	0.0033	
recall: 0.0038	0.0059	0.0088	0.0145	0.0169	0.0287	0.0652	
f1: 0.0032	0.0035	0.0032	0.0040	0.0038	0.0044	0.0062	
ndcg: 0.0045	0.0077	0.0096	0.0133	0.0149	0.0207	0.0362	

epoch 1    train auc: 0.5179  acc: 0.5138    eval auc: 0.4774  acc: 0.4832    test auc: 0.4694  acc: 0.4755, pre: 0.4786, rec: 0.5934, f1: 0.5298
epoch 2    train auc: 0.0000  acc: 0.0000    eval auc: 0.0000  acc: 0.0000    test auc: 0.0000  acc: 0.0000, pre: 0.0000, rec: 0.0000, f1: 0.0000
epoch 3    train auc: 0.8052  acc: 0.6497    eval auc: 0.7458  acc: 0.6466    test auc: 0.7555  acc: 0.6599, pre: 0.9539, rec: 0.3333, f1: 0.4940
precision: 0.0357	0.0322	0.0277	0.0242	0.0220	0.0192	0.0145	
recall: 0.0314	0.0713	0.1185	0.1541	0.1855	0.2371	0.3005	
f1: 0.0334	0.0444	0.0449	0.0419	0.0394	0.0354	0.0278	
ndcg: 0.0577	0.0922	0.1217	0.1359	0.1466	0.1606	0.1756	

epoch 4    train auc: 0.8780  acc: 0.7364    eval auc: 0.7902  acc: 0.7163    test auc: 0.7999  acc: 0.7396, pre: 0.9050, rec: 0.5332, f1: 0.6710
precision: 0.0342	0.0297	0.0288	0.0249	0.0233	0.0185	0.0144	
recall: 0.0271	0.0626	0.1231	0.1578	0.1958	0.2309	0.2960	
f1: 0.0302	0.0403	0.0467	0.0430	0.0417	0.0342	0.0275	
ndcg: 0.0514	0.0817	0.1173	0.1325	0.1446	0.1544	0.1697	

epoch 5    train auc: 0.8883  acc: 0.7666    eval auc: 0.7925  acc: 0.7383    test auc: 0.8026  acc: 0.7611, pre: 0.8742, rec: 0.6079, f1: 0.7171
precision: 0.0312	0.0295	0.0282	0.0253	0.0206	0.0177	0.0139	
recall: 0.0253	0.0628	0.1215	0.1585	0.1710	0.2198	0.2843	
f1: 0.0279	0.0401	0.0457	0.0436	0.0368	0.0327	0.0265	
ndcg: 0.0484	0.0822	0.1163	0.1340	0.1390	0.1520	0.1672	

epoch 6    train auc: 0.8963  acc: 0.7751    eval auc: 0.7937  acc: 0.7452    test auc: 0.8047  acc: 0.7640, pre: 0.8557, rec: 0.6328, f1: 0.7275
precision: 0.0336	0.0295	0.0278	0.0236	0.0203	0.0168	0.0131	
recall: 0.0270	0.0628	0.1174	0.1493	0.1669	0.2101	0.2687	
f1: 0.0299	0.0401	0.0450	0.0408	0.0361	0.0310	0.0251	
ndcg: 0.0505	0.0814	0.1146	0.1292	0.1361	0.1483	0.1626	

epoch 7    train auc: 0.9012  acc: 0.7834    eval auc: 0.7951  acc: 0.7501    test auc: 0.8066  acc: 0.7650, pre: 0.8368, rec: 0.6562, f1: 0.7356
precision: 0.0342	0.0292	0.0238	0.0218	0.0198	0.0160	0.0128	
recall: 0.0271	0.0628	0.1016	0.1372	0.1645	0.1997	0.2629	
f1: 0.0302	0.0399	0.0386	0.0376	0.0353	0.0297	0.0245	
ndcg: 0.0514	0.0810	0.1055	0.1217	0.1323	0.1436	0.1581	

epoch 8    train auc: 0.9041  acc: 0.7845    eval auc: 0.7955  acc: 0.7491    test auc: 0.8069  acc: 0.7628, pre: 0.8302, rec: 0.6584, f1: 0.7344
epoch 9    train auc: 0.9063  acc: 0.7924    eval auc: 0.7944  acc: 0.7501    test auc: 0.8057  acc: 0.7586, pre: 0.8040, rec: 0.6816, f1: 0.7377
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 18:48:15.124036 140156127065856 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 18:48:15.141246 140156127065856 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 18:48:15.141890 140156127065856 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 18:48:15.174989 140156127065856 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 18:48:15.223131 140156127065856 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 18:48:15.224876 140156127065856 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 18:48:15.320534 140156127065856 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 18:48:15.348483 140156127065856 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 18:48:16.328591 140156127065856 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 18:48:16.329829: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 18:48:16.339875: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:48:16.340044: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:48:16.341195: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:48:16.342417: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:48:16.342695: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:48:16.344067: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:48:16.345212: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:48:16.348941: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:48:16.350813: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:48:16.351140: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 18:48:16.468695: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55fb82c15250 executing computations on platform CUDA. Devices:
2020-01-07 18:48:16.468756: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 18:48:16.489554: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 18:48:16.491839: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55fb82d0d0b0 executing computations on platform Host. Devices:
2020-01-07 18:48:16.491878: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 18:48:16.493125: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:48:16.493180: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:48:16.493192: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:48:16.493202: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:48:16.493212: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:48:16.493223: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:48:16.493233: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:48:16.493244: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:48:16.495027: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:48:16.495063: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:48:16.496471: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 18:48:16.496485: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 18:48:16.496492: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 18:48:16.498730: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 18:48:16.501459 140156127065856 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 18:48:18.114451: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=2, batch_size=256, dataset='music', dim=4, gpu_id='0', kge_interval=2, l2_weight=1e-06, lr_kge=0.0002, lr_rs=0.001, n_epochs=10)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.4960  acc: 0.4998    eval auc: 0.5110  acc: 0.5024    test auc: 0.5009  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
precision: 0.0015	0.0018	0.0016	0.0016	0.0016	0.0019	0.0034	
recall: 0.0014	0.0037	0.0059	0.0092	0.0126	0.0223	0.0684	
f1: 0.0014	0.0024	0.0025	0.0027	0.0029	0.0036	0.0065	
ndcg: 0.0026	0.0050	0.0069	0.0084	0.0100	0.0150	0.0343	

epoch 1    train auc: 0.4963  acc: 0.4961    eval auc: 0.5070  acc: 0.5092    test auc: 0.5041  acc: 0.5024, pre: 0.5002, rec: 0.9490, f1: 0.6552
precision: 0.0012	0.0013	0.0013	0.0012	0.0012	0.0018	0.0038	
recall: 0.0012	0.0024	0.0042	0.0060	0.0079	0.0191	0.0726	
f1: 0.0012	0.0017	0.0019	0.0020	0.0020	0.0033	0.0072	
ndcg: 0.0017	0.0035	0.0051	0.0060	0.0071	0.0130	0.0360	

epoch 2    train auc: 0.5016  acc: 0.5002    eval auc: 0.4970  acc: 0.5021    test auc: 0.4981  acc: 0.4975, pre: 0.4978, rec: 0.9969, f1: 0.6640
epoch 3    train auc: 0.5023  acc: 0.4998    eval auc: 0.4967  acc: 0.5024    test auc: 0.4963  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 4    train auc: 0.5020  acc: 0.4998    eval auc: 0.5088  acc: 0.5024    test auc: 0.4854  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 5    train auc: 0.5053  acc: 0.4998    eval auc: 0.4944  acc: 0.5024    test auc: 0.4896  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 6    train auc: 0.5192  acc: 0.4998    eval auc: 0.4755  acc: 0.5024    test auc: 0.4667  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 7    train auc: 0.5526  acc: 0.4998    eval auc: 0.4332  acc: 0.5024    test auc: 0.4312  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 8    train auc: 0.8316  acc: 0.6428    eval auc: 0.7288  acc: 0.5493    test auc: 0.7393  acc: 0.5553, pre: 0.5322, rec: 0.8855, f1: 0.6648
precision: 0.0365	0.0325	0.0290	0.0262	0.0229	0.0186	0.0146	
recall: 0.0318	0.0662	0.1223	0.1631	0.1888	0.2310	0.2975	
f1: 0.0340	0.0436	0.0469	0.0452	0.0409	0.0344	0.0278	
ndcg: 0.0568	0.0893	0.1221	0.1398	0.1477	0.1593	0.1756	

epoch 9    train auc: 0.8615  acc: 0.7460    eval auc: 0.7628  acc: 0.7174    test auc: 0.7674  acc: 0.7396, pre: 0.8906, rec: 0.5441, f1: 0.6755
precision: 0.0309	0.0321	0.0268	0.0239	0.0213	0.0181	0.0137	
recall: 0.0234	0.0648	0.1122	0.1511	0.1767	0.2240	0.2782	
f1: 0.0266	0.0429	0.0433	0.0413	0.0380	0.0336	0.0261	
ndcg: 0.0500	0.0881	0.1174	0.1333	0.1429	0.1541	0.1679	

/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 18:49:09.916452 140202886665984 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 18:49:09.933850 140202886665984 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 18:49:09.934484 140202886665984 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 18:49:09.968010 140202886665984 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 18:49:10.016741 140202886665984 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 18:49:10.018523 140202886665984 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 18:49:10.115552 140202886665984 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 18:49:10.144172 140202886665984 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 18:49:11.138044 140202886665984 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 18:49:11.139238: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 18:49:11.149044: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:49:11.149217: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:49:11.150387: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:49:11.151623: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:49:11.151899: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:49:11.153324: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:49:11.154483: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:49:11.158254: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:49:11.160129: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:49:11.160471: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 18:49:11.324804: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55573285acf0 executing computations on platform CUDA. Devices:
2020-01-07 18:49:11.324864: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 18:49:11.345660: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 18:49:11.347741: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x555732952b60 executing computations on platform Host. Devices:
2020-01-07 18:49:11.347800: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 18:49:11.354684: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:49:11.354745: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:49:11.354762: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:49:11.354775: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:49:11.354787: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:49:11.354800: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:49:11.354812: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:49:11.354825: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:49:11.356756: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:49:11.356791: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:49:11.358365: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 18:49:11.358379: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 18:49:11.358387: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 18:49:11.360673: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 18:49:11.363255 140202886665984 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 18:49:12.791956: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=2, batch_size=256, dataset='music', dim=4, gpu_id='0', kge_interval=2, l2_weight=1e-06, lr_kge=0.0002, lr_rs=0.001, n_epochs=10)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.4893  acc: 0.4918    eval auc: 0.5164  acc: 0.5151    test auc: 0.5175  acc: 0.5095, pre: 0.5085, rec: 0.4547, f1: 0.4801
precision: 0.0114	0.0140	0.0103	0.0081	0.0066	0.0051	0.0048	
recall: 0.0089	0.0265	0.0403	0.0476	0.0503	0.0589	0.0989	
f1: 0.0100	0.0183	0.0164	0.0139	0.0116	0.0094	0.0092	
ndcg: 0.0188	0.0374	0.0456	0.0493	0.0511	0.0552	0.0703	

epoch 1    train auc: 0.5934  acc: 0.4998    eval auc: 0.5420  acc: 0.5024    test auc: 0.5471  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 2    train auc: 0.8433  acc: 0.7165    eval auc: 0.7965  acc: 0.7041    test auc: 0.8049  acc: 0.7235, pre: 0.9176, rec: 0.4886, f1: 0.6377
precision: 0.0312	0.0315	0.0283	0.0252	0.0227	0.0184	0.0142	
recall: 0.0232	0.0622	0.1184	0.1577	0.1890	0.2267	0.2926	
f1: 0.0266	0.0418	0.0457	0.0435	0.0406	0.0340	0.0271	
ndcg: 0.0535	0.0883	0.1200	0.1360	0.1457	0.1556	0.1714	

epoch 3    train auc: 0.8751  acc: 0.7544    eval auc: 0.7986  acc: 0.7321    test auc: 0.8052  acc: 0.7531, pre: 0.8894, rec: 0.5759, f1: 0.6991
precision: 0.0321	0.0301	0.0268	0.0234	0.0211	0.0175	0.0140	
recall: 0.0246	0.0595	0.1108	0.1438	0.1751	0.2171	0.2856	
f1: 0.0279	0.0399	0.0432	0.0402	0.0376	0.0324	0.0267	
ndcg: 0.0490	0.0812	0.1097	0.1240	0.1352	0.1476	0.1638	

epoch 4    train auc: 0.8880  acc: 0.7670    eval auc: 0.7983  acc: 0.7380    test auc: 0.8065  acc: 0.7589, pre: 0.8721, rec: 0.6046, f1: 0.7141
precision: 0.0276	0.0301	0.0255	0.0216	0.0182	0.0164	0.0132	
recall: 0.0221	0.0595	0.1031	0.1332	0.1513	0.2041	0.2733	
f1: 0.0245	0.0399	0.0409	0.0372	0.0325	0.0303	0.0252	
ndcg: 0.0437	0.0803	0.1056	0.1198	0.1254	0.1402	0.1572	

epoch 5    train auc: 0.8964  acc: 0.7822    eval auc: 0.7988  acc: 0.7491    test auc: 0.8091  acc: 0.7631, pre: 0.8347, rec: 0.6539, f1: 0.7333
precision: 0.0273	0.0289	0.0232	0.0190	0.0179	0.0155	0.0125	
recall: 0.0229	0.0576	0.0932	0.1151	0.1488	0.1920	0.2574	
f1: 0.0249	0.0385	0.0371	0.0326	0.0320	0.0286	0.0238	
ndcg: 0.0424	0.0761	0.0991	0.1074	0.1214	0.1341	0.1498	

epoch 6    train auc: 0.9005  acc: 0.7907    eval auc: 0.7990  acc: 0.7459    test auc: 0.8103  acc: 0.7545, pre: 0.7980, rec: 0.6790, f1: 0.7337
epoch 7    train auc: 0.9061  acc: 0.8020    eval auc: 0.7972  acc: 0.7374    test auc: 0.8086  acc: 0.7441, pre: 0.7580, rec: 0.7143, f1: 0.7355
epoch 8    train auc: 0.9106  acc: 0.8040    eval auc: 0.7947  acc: 0.7347    test auc: 0.8058  acc: 0.7388, pre: 0.7496, rec: 0.7141, f1: 0.7314
epoch 9    train auc: 0.9161  acc: 0.8103    eval auc: 0.7913  acc: 0.7304    test auc: 0.8018  acc: 0.7323, pre: 0.7356, rec: 0.7221, f1: 0.7288
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 18:50:18.768189 140253480105728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 18:50:18.785439 140253480105728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 18:50:18.786069 140253480105728 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 18:50:18.819331 140253480105728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 18:50:18.867665 140253480105728 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 18:50:18.869436 140253480105728 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 18:50:18.966215 140253480105728 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 18:50:18.994652 140253480105728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 18:50:19.984580 140253480105728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 18:50:19.985783: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 18:50:19.995719: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:50:19.995886: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:50:19.997044: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:50:19.998259: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:50:19.998529: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:50:19.999915: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:50:20.001068: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:50:20.004821: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:50:20.006726: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:50:20.007065: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 18:50:20.123027: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x559530559ee0 executing computations on platform CUDA. Devices:
2020-01-07 18:50:20.123086: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 18:50:20.145568: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 18:50:20.148144: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x559530651d20 executing computations on platform Host. Devices:
2020-01-07 18:50:20.148182: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 18:50:20.149437: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:50:20.149538: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:50:20.149555: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:50:20.149568: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:50:20.149591: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:50:20.149603: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:50:20.149615: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:50:20.149628: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:50:20.151393: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:50:20.151426: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:50:20.152831: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 18:50:20.152843: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 18:50:20.152850: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 18:50:20.155128: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 18:50:20.157916 140253480105728 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 18:50:21.654508: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=2, batch_size=256, dataset='music', dim=4, gpu_id='0', kge_interval=2, l2_weight=1e-06, lr_kge=0.0002, lr_rs=0.001, n_epochs=10)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.5103  acc: 0.5098    eval auc: 0.4844  acc: 0.4874    test auc: 0.4866  acc: 0.4831, pre: 0.4887, rec: 0.8234, f1: 0.6134
precision: 0.0123	0.0092	0.0070	0.0063	0.0052	0.0046	0.0048	
recall: 0.0110	0.0192	0.0282	0.0374	0.0408	0.0531	0.0945	
f1: 0.0116	0.0125	0.0112	0.0108	0.0092	0.0085	0.0091	
ndcg: 0.0189	0.0271	0.0330	0.0378	0.0394	0.0460	0.0622	

epoch 1    train auc: 0.5406  acc: 0.5281    eval auc: 0.4968  acc: 0.5142    test auc: 0.5022  acc: 0.5217, pre: 0.5295, rec: 0.3551, f1: 0.4251
precision: 0.0159	0.0132	0.0122	0.0103	0.0094	0.0076	0.0063	
recall: 0.0146	0.0294	0.0496	0.0631	0.0776	0.0945	0.1309	
f1: 0.0152	0.0182	0.0195	0.0178	0.0167	0.0141	0.0120	
ndcg: 0.0269	0.0412	0.0555	0.0619	0.0669	0.0724	0.0843	

epoch 2    train auc: 0.6606  acc: 0.4998    eval auc: 0.5975  acc: 0.5024    test auc: 0.6107  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 3    train auc: 0.8413  acc: 0.7251    eval auc: 0.7971  acc: 0.7087    test auc: 0.8010  acc: 0.7297, pre: 0.9092, rec: 0.5081, f1: 0.6519
precision: 0.0297	0.0308	0.0292	0.0245	0.0222	0.0181	0.0135	
recall: 0.0231	0.0632	0.1174	0.1497	0.1841	0.2237	0.2740	
f1: 0.0260	0.0414	0.0467	0.0421	0.0396	0.0335	0.0257	
ndcg: 0.0485	0.0843	0.1172	0.1300	0.1414	0.1518	0.1642	

epoch 4    train auc: 0.8743  acc: 0.7615    eval auc: 0.7972  acc: 0.7375    test auc: 0.8053  acc: 0.7577, pre: 0.8789, rec: 0.5955, f1: 0.7100
precision: 0.0270	0.0308	0.0270	0.0234	0.0218	0.0179	0.0134	
recall: 0.0213	0.0630	0.1091	0.1416	0.1792	0.2228	0.2761	
f1: 0.0238	0.0414	0.0433	0.0402	0.0388	0.0331	0.0256	
ndcg: 0.0463	0.0849	0.1140	0.1284	0.1401	0.1519	0.1642	

epoch 5    train auc: 0.8877  acc: 0.7722    eval auc: 0.7994  acc: 0.7427    test auc: 0.8083  acc: 0.7610, pre: 0.8583, rec: 0.6230, f1: 0.7220
precision: 0.0270	0.0264	0.0231	0.0215	0.0187	0.0161	0.0128	
recall: 0.0213	0.0510	0.0911	0.1310	0.1535	0.2001	0.2631	
f1: 0.0238	0.0348	0.0368	0.0369	0.0333	0.0297	0.0245	
ndcg: 0.0463	0.0793	0.1022	0.1193	0.1273	0.1419	0.1550	

epoch 6    train auc: 0.8951  acc: 0.7833    eval auc: 0.7999  acc: 0.7491    test auc: 0.8096  acc: 0.7630, pre: 0.8311, rec: 0.6579, f1: 0.7344
precision: 0.0255	0.0185	0.0224	0.0198	0.0177	0.0151	0.0117	
recall: 0.0202	0.0362	0.0896	0.1206	0.1438	0.1878	0.2392	
f1: 0.0225	0.0244	0.0359	0.0340	0.0315	0.0279	0.0223	
ndcg: 0.0442	0.0601	0.0953	0.1096	0.1172	0.1319	0.1448	

epoch 7    train auc: 0.8987  acc: 0.7864    eval auc: 0.7995  acc: 0.7486    test auc: 0.8101  acc: 0.7586, pre: 0.8199, rec: 0.6605, f1: 0.7316
epoch 8    train auc: 0.9019  acc: 0.7912    eval auc: 0.7977  acc: 0.7471    test auc: 0.8077  acc: 0.7546, pre: 0.7987, rec: 0.6783, f1: 0.7336
epoch 9    train auc: 0.9038  acc: 0.7921    eval auc: 0.7965  acc: 0.7465    test auc: 0.8070  acc: 0.7537, pre: 0.7981, rec: 0.6766, f1: 0.7324
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 18:51:37.798545 139836049954560 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 18:51:37.815812 139836049954560 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 18:51:37.816443 139836049954560 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 18:51:37.849836 139836049954560 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 18:51:37.897947 139836049954560 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 18:51:37.899708 139836049954560 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 18:51:37.996222 139836049954560 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 18:51:38.024491 139836049954560 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 18:51:39.009335 139836049954560 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 18:51:39.010556: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 18:51:39.020228: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:51:39.020407: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:51:39.021614: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:51:39.022863: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:51:39.023156: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:51:39.024816: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:51:39.026027: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:51:39.029816: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:51:39.031685: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:51:39.032019: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 18:51:39.130501: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5580f13ccc20 executing computations on platform CUDA. Devices:
2020-01-07 18:51:39.130547: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 18:51:39.153579: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 18:51:39.155532: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5580f14c4af0 executing computations on platform Host. Devices:
2020-01-07 18:51:39.155598: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 18:51:39.156859: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:51:39.156921: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:51:39.156934: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:51:39.156944: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:51:39.156955: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:51:39.156965: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:51:39.156975: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:51:39.156987: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:51:39.158771: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:51:39.158804: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:51:39.160132: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 18:51:39.160144: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 18:51:39.160151: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 18:51:39.162321: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 18:51:39.164997 139836049954560 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 18:51:40.610314: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=2, batch_size=256, dataset='music', dim=4, gpu_id='0', kge_interval=2, l2_weight=1e-06, lr_kge=0.0002, lr_rs=0.001, n_epochs=10)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.4988  acc: 0.4947    eval auc: 0.5018  acc: 0.5064    test auc: 0.5045  acc: 0.5094, pre: 0.5142, rec: 0.2712, f1: 0.3551
precision: 0.0222	0.0204	0.0137	0.0107	0.0090	0.0071	0.0060	
recall: 0.0200	0.0419	0.0554	0.0666	0.0748	0.0882	0.1206	
f1: 0.0210	0.0274	0.0219	0.0185	0.0160	0.0131	0.0114	
ndcg: 0.0364	0.0589	0.0671	0.0718	0.0758	0.0812	0.0932	

epoch 1    train auc: 0.4975  acc: 0.4998    eval auc: 0.5482  acc: 0.5024    test auc: 0.5444  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 2    train auc: 0.8199  acc: 0.6341    eval auc: 0.7462  acc: 0.6303    test auc: 0.7628  acc: 0.6425, pre: 0.9454, rec: 0.2994, f1: 0.4548
precision: 0.0303	0.0280	0.0283	0.0253	0.0221	0.0184	0.0146	
recall: 0.0276	0.0616	0.1211	0.1583	0.1831	0.2290	0.3014	
f1: 0.0289	0.0385	0.0459	0.0437	0.0395	0.0340	0.0278	
ndcg: 0.0501	0.0807	0.1170	0.1346	0.1417	0.1544	0.1693	

epoch 3    train auc: 0.8800  acc: 0.7376    eval auc: 0.7862  acc: 0.7171    test auc: 0.7955  acc: 0.7407, pre: 0.9047, rec: 0.5358, f1: 0.6730
precision: 0.0267	0.0301	0.0260	0.0258	0.0221	0.0186	0.0142	
recall: 0.0222	0.0648	0.1084	0.1599	0.1826	0.2320	0.2935	
f1: 0.0242	0.0411	0.0419	0.0444	0.0394	0.0345	0.0271	
ndcg: 0.0408	0.0778	0.1037	0.1282	0.1362	0.1472	0.1623	

epoch 4    train auc: 0.8912  acc: 0.7565    eval auc: 0.7916  acc: 0.7297    test auc: 0.8023  acc: 0.7543, pre: 0.8876, rec: 0.5801, f1: 0.7016
precision: 0.0303	0.0288	0.0273	0.0241	0.0207	0.0172	0.0135	
recall: 0.0258	0.0597	0.1117	0.1508	0.1720	0.2137	0.2797	
f1: 0.0278	0.0388	0.0438	0.0416	0.0369	0.0318	0.0258	
ndcg: 0.0453	0.0759	0.1072	0.1257	0.1336	0.1451	0.1588	

epoch 5    train auc: 0.8974  acc: 0.7755    eval auc: 0.7943  acc: 0.7424    test auc: 0.8056  acc: 0.7612, pre: 0.8506, rec: 0.6316, f1: 0.7249
precision: 0.0246	0.0276	0.0268	0.0219	0.0193	0.0162	0.0128	
recall: 0.0216	0.0562	0.1100	0.1366	0.1611	0.2021	0.2639	
f1: 0.0230	0.0370	0.0432	0.0378	0.0345	0.0300	0.0244	
ndcg: 0.0384	0.0716	0.1042	0.1171	0.1274	0.1382	0.1535	

epoch 6    train auc: 0.9006  acc: 0.7749    eval auc: 0.7952  acc: 0.7399    test auc: 0.8078  acc: 0.7592, pre: 0.8500, rec: 0.6273, f1: 0.7219
epoch 7    train auc: 0.9037  acc: 0.7883    eval auc: 0.7957  acc: 0.7474    test auc: 0.8071  acc: 0.7605, pre: 0.8132, rec: 0.6740, f1: 0.7371
precision: 0.0240	0.0259	0.0220	0.0195	0.0175	0.0154	0.0120	
recall: 0.0208	0.0530	0.0878	0.1222	0.1465	0.1912	0.2453	
f1: 0.0222	0.0348	0.0352	0.0336	0.0313	0.0285	0.0228	
ndcg: 0.0374	0.0692	0.0931	0.1085	0.1167	0.1314	0.1454	

epoch 8    train auc: 0.9053  acc: 0.7855    eval auc: 0.7958  acc: 0.7461    test auc: 0.8074  acc: 0.7592, pre: 0.8200, rec: 0.6619, f1: 0.7325
epoch 9    train auc: 0.9072  acc: 0.7924    eval auc: 0.7953  acc: 0.7481    test auc: 0.8062  acc: 0.7565, pre: 0.7998, rec: 0.6818, f1: 0.7361
precision: 0.0225	0.0232	0.0194	0.0172	0.0163	0.0140	0.0103	
recall: 0.0193	0.0471	0.0772	0.1069	0.1371	0.1746	0.2114	
f1: 0.0208	0.0311	0.0309	0.0297	0.0291	0.0259	0.0196	
ndcg: 0.0360	0.0645	0.0851	0.0986	0.1096	0.1225	0.1338	

/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 18:53:12.004447 139685169473280 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 18:53:12.022059 139685169473280 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 18:53:12.022693 139685169473280 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 18:53:12.055915 139685169473280 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 18:53:12.104123 139685169473280 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 18:53:12.105888 139685169473280 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 18:53:12.201036 139685169473280 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 18:53:12.229247 139685169473280 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 18:53:13.206155 139685169473280 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 18:53:13.207405: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 18:53:13.216077: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:53:13.216262: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:53:13.217472: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:53:13.218689: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:53:13.218970: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:53:13.220413: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:53:13.221574: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:53:13.225266: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:53:13.227131: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:53:13.227463: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 18:53:13.334419: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x563120e8f1b0 executing computations on platform CUDA. Devices:
2020-01-07 18:53:13.334479: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 18:53:13.357652: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 18:53:13.359762: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x563120f87020 executing computations on platform Host. Devices:
2020-01-07 18:53:13.359825: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 18:53:13.361088: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:53:13.361165: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:53:13.361193: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:53:13.361208: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:53:13.361222: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:53:13.361236: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:53:13.361250: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:53:13.361264: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:53:13.363210: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:53:13.363251: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:53:13.364810: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 18:53:13.364828: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 18:53:13.364836: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 18:53:13.367306: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 18:53:13.370002 139685169473280 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 18:53:14.927786: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
Namespace(H=1, L=2, batch_size=256, dataset='music', dim=4, gpu_id='0', kge_interval=2, l2_weight=1e-06, lr_kge=0.0002, lr_rs=0.001, n_epochs=10)
reading rating file ...
reading KG file ...
data loaded.
epoch 0    train auc: 0.4860  acc: 0.4998    eval auc: 0.5216  acc: 0.5024    test auc: 0.5216  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
precision: 0.0171	0.0104	0.0065	0.0052	0.0044	0.0041	0.0039	
recall: 0.0158	0.0231	0.0278	0.0335	0.0366	0.0526	0.0826	
f1: 0.0164	0.0144	0.0106	0.0091	0.0078	0.0076	0.0075	
ndcg: 0.0271	0.0354	0.0394	0.0423	0.0441	0.0517	0.0638	

epoch 1    train auc: 0.5137  acc: 0.4999    eval auc: 0.4962  acc: 0.4984    test auc: 0.5010  acc: 0.5018, pre: 0.4783, rec: 0.0026, f1: 0.0052
epoch 2    train auc: 0.7926  acc: 0.4998    eval auc: 0.7581  acc: 0.5024    test auc: 0.7740  acc: 0.4981, pre: 0.4981, rec: 1.0000, f1: 0.6649
epoch 3    train auc: 0.8701  acc: 0.7349    eval auc: 0.7889  acc: 0.7160    test auc: 0.8005  acc: 0.7363, pre: 0.9056, rec: 0.5254, f1: 0.6650
precision: 0.0282	0.0320	0.0295	0.0259	0.0232	0.0186	0.0147	
recall: 0.0223	0.0647	0.1248	0.1611	0.1934	0.2313	0.2998	
f1: 0.0249	0.0428	0.0478	0.0447	0.0415	0.0344	0.0280	
ndcg: 0.0479	0.0870	0.1215	0.1384	0.1479	0.1576	0.1745	

epoch 4    train auc: 0.8859  acc: 0.7717    eval auc: 0.7927  acc: 0.7418    test auc: 0.8025  acc: 0.7624, pre: 0.8626, rec: 0.6221, f1: 0.7229
precision: 0.0258	0.0266	0.0256	0.0224	0.0201	0.0166	0.0134	
recall: 0.0204	0.0560	0.1050	0.1391	0.1683	0.2079	0.2752	
f1: 0.0227	0.0361	0.0412	0.0387	0.0359	0.0307	0.0255	
ndcg: 0.0446	0.0777	0.1093	0.1244	0.1339	0.1466	0.1620	

epoch 5    train auc: 0.8944  acc: 0.7766    eval auc: 0.7939  acc: 0.7439    test auc: 0.8062  acc: 0.7617, pre: 0.8494, rec: 0.6339, f1: 0.7260
precision: 0.0255	0.0235	0.0182	0.0176	0.0165	0.0144	0.0126	
recall: 0.0202	0.0468	0.0754	0.1082	0.1345	0.1780	0.2589	
f1: 0.0225	0.0313	0.0293	0.0303	0.0294	0.0267	0.0240	
ndcg: 0.0440	0.0723	0.0882	0.1055	0.1162	0.1290	0.1510	

epoch 6    train auc: 0.8992  acc: 0.7869    eval auc: 0.7958  acc: 0.7437    test auc: 0.8081  acc: 0.7610, pre: 0.8169, rec: 0.6705, f1: 0.7365
epoch 7    train auc: 0.9013  acc: 0.7890    eval auc: 0.7960  acc: 0.7408    test auc: 0.8095  acc: 0.7525, pre: 0.7974, rec: 0.6745, f1: 0.7308
epoch 8    train auc: 0.9040  acc: 0.7961    eval auc: 0.7957  acc: 0.7373    test auc: 0.8087  acc: 0.7491, pre: 0.7665, rec: 0.7136, f1: 0.7391
epoch 9    train auc: 0.9060  acc: 0.7970    eval auc: 0.7951  acc: 0.7366    test auc: 0.8081  acc: 0.7466, pre: 0.7591, rec: 0.7195, f1: 0.7388
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING: Logging before flag parsing goes to stderr.
W0107 18:54:09.776633 140051635070720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:80: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

W0107 18:54:09.793995 140051635070720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:92: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W0107 18:54:09.794632 140051635070720 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0107 18:54:09.827994 140051635070720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/layers.py:40: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0107 18:54:09.876195 140051635070720 deprecation.py:506] From /home/wudong/workspace/MKR/src_org/layers.py:46: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W0107 18:54:09.877976 140051635070720 deprecation.py:506] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/util/dispatch.py:180: calling expand_dims (from tensorflow.python.ops.array_ops) with dim is deprecated and will be removed in a future version.
Instructions for updating:
Use the `axis` argument instead
W0107 18:54:09.975931 140051635070720 deprecation.py:323] From /home/wudong/anaconda3/envs/rec/lib/python3.6/site-packages/tensorflow/python/ops/nn_impl.py:180: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0107 18:54:10.005133 140051635070720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/model.py:174: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0107 18:54:11.000119 140051635070720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:29: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

2020-01-07 18:54:11.001382: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2020-01-07 18:54:11.010100: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:54:11.010285: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:54:11.011441: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:54:11.012675: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:54:11.012950: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:54:11.014354: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:54:11.015515: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:54:11.019268: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:54:11.021096: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:54:11.021440: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-01-07 18:54:11.142265: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5582be5ab040 executing computations on platform CUDA. Devices:
2020-01-07 18:54:11.142325: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Tesla T4, Compute Capability 7.5
2020-01-07 18:54:11.161625: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-01-07 18:54:11.163852: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5582be6a2ed0 executing computations on platform Host. Devices:
2020-01-07 18:54:11.163878: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2020-01-07 18:54:11.165060: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: Tesla T4 major: 7 minor: 5 memoryClockRate(GHz): 1.59
pciBusID: 0000:3b:00.0
2020-01-07 18:54:11.165102: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:54:11.165114: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2020-01-07 18:54:11.165125: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2020-01-07 18:54:11.165135: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2020-01-07 18:54:11.165145: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2020-01-07 18:54:11.165155: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2020-01-07 18:54:11.165166: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2020-01-07 18:54:11.166940: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2020-01-07 18:54:11.166970: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2020-01-07 18:54:11.168359: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-01-07 18:54:11.168371: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2020-01-07 18:54:11.168377: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2020-01-07 18:54:11.170607: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14221 MB memory) -> physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:3b:00.0, compute capability: 7.5)
W0107 18:54:11.173244 140051635070720 deprecation_wrapper.py:119] From /home/wudong/workspace/MKR/src_org/train.py:30: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

2020-01-07 18:54:12.637585: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
